{"ast":null,"code":"import _classCallCheck from \"/home/bitnami/Viewers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bitnami/Viewers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/bitnami/Viewers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bitnami/Viewers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/bitnami/Viewers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/bitnami/Viewers/src/connectedComponents/ToolContextMenu.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneTools from 'cornerstone-tools';\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback';\nimport './ToolContextMenu.css';\nvar toolTypes = ['Angle', 'Bidirectional', 'Length', 'FreehandMouse', 'EllipticalRoi', 'CircleRoi', 'RectangleRoi'];\nvar defaultDropdownItems = [{\n  actionType: 'Delete',\n  action: function action(_ref) {\n    var nearbyToolData = _ref.nearbyToolData,\n        eventData = _ref.eventData;\n    var element = eventData.element;\n    cornerstoneTools.removeToolState(element, nearbyToolData.toolType, nearbyToolData.tool);\n    cornerstone.updateImage(element);\n  }\n}, {\n  actionType: 'setLabel',\n  action: function action(_ref2) {\n    var nearbyToolData = _ref2.nearbyToolData,\n        eventData = _ref2.eventData;\n    var tool = nearbyToolData.tool;\n    var options = {\n      skipAddLabelButton: true,\n      editLocation: true\n    };\n    getMeasurementLocationCallback(eventData, tool, options);\n  }\n}, {\n  actionType: 'setDescription',\n  action: function action(_ref3) {\n    var nearbyToolData = _ref3.nearbyToolData,\n        eventData = _ref3.eventData;\n    var tool = nearbyToolData.tool;\n    var options = {\n      editDescriptionOnDialog: true\n    };\n    getMeasurementLocationCallback(eventData, tool, options);\n  }\n}];\n\nfunction getNearbyToolData(element, coords, toolTypes) {\n  var nearbyTool = {};\n  var pointNearTool = false;\n  toolTypes.forEach(function (toolType) {\n    var toolData = cornerstoneTools.getToolState(element, toolType);\n\n    if (!toolData) {\n      return;\n    }\n\n    toolData.data.forEach(function (data, index) {\n      // TODO: Fix this, it's ugly\n      var toolInterface = cornerstoneTools.getToolForElement(element, toolType);\n\n      if (!toolInterface) {\n        toolInterface = cornerstoneTools.getToolForElement(element, \"\".concat(toolType, \"Tool\"));\n      }\n\n      if (!toolInterface) {\n        throw new Error('Tool not found.');\n      }\n\n      if (toolInterface.pointNearTool(element, data, coords)) {\n        pointNearTool = true;\n        nearbyTool.tool = data;\n        nearbyTool.index = index;\n        nearbyTool.toolType = toolType;\n      }\n    });\n\n    if (pointNearTool) {\n      return false;\n    }\n  });\n  return pointNearTool ? nearbyTool : undefined;\n}\n\nfunction getDropdownItems(eventData) {\n  var isTouchEvent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var availableTools = arguments.length > 2 ? arguments[2] : undefined;\n  var nearbyToolData = getNearbyToolData(eventData.element, eventData.currentPoints.canvas, toolTypes, availableTools); // Annotate tools for touch events already have a press handle to edit it, has a better UX for deleting it\n\n  if (isTouchEvent && nearbyToolData && nearbyToolData.toolType === 'arrowAnnotate') {\n    return;\n  }\n\n  var dropdownItems = [];\n\n  if (nearbyToolData) {\n    defaultDropdownItems.forEach(function (item) {\n      item.params = {\n        eventData: eventData,\n        nearbyToolData: nearbyToolData\n      };\n\n      if (item.actionType === 'Delete') {\n        item.text = 'Delete measurement';\n      }\n\n      if (item.actionType === 'setLabel') {\n        item.text = 'Relabel';\n      }\n\n      if (item.actionType === 'setDescription') {\n        item.text = \"\".concat(nearbyToolData.tool.description ? 'Edit' : 'Add', \" Description\");\n      }\n\n      dropdownItems.push(item);\n    });\n  }\n\n  return dropdownItems;\n}\n\nvar ToolContextMenu =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ToolContextMenu, _Component);\n\n  function ToolContextMenu(props) {\n    var _this;\n\n    _classCallCheck(this, ToolContextMenu);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ToolContextMenu).call(this, props));\n\n    _this.componentDidMount = function () {\n      if (_this.mainElement.current) {\n        _this.updateElementPosition();\n      }\n    };\n\n    _this.componentDidUpdate = function () {\n      if (_this.mainElement.current) {\n        _this.updateElementPosition();\n      }\n    };\n\n    _this.updateElementPosition = function () {\n      var _this$mainElement$cur = _this.mainElement.current,\n          offsetParent = _this$mainElement$cur.offsetParent,\n          offsetTop = _this$mainElement$cur.offsetTop,\n          offsetHeight = _this$mainElement$cur.offsetHeight,\n          offsetWidth = _this$mainElement$cur.offsetWidth,\n          offsetLeft = _this$mainElement$cur.offsetLeft;\n      var eventData = _this.props.eventData;\n\n      if (offsetTop + offsetHeight > offsetParent.offsetHeight) {\n        var offBoundPixels = offsetTop + offsetHeight - offsetParent.offsetHeight;\n        var top = eventData.currentPoints.canvas.y - offBoundPixels;\n        _this.mainElement.current.style.top = \"\".concat(top > 0 ? top : 0, \"px\");\n      }\n\n      if (offsetLeft + offsetWidth > offsetParent.offsetWidth) {\n        var _offBoundPixels = offsetLeft + offsetWidth - offsetParent.offsetWidth;\n\n        var left = eventData.currentPoints.canvas.x - _offBoundPixels;\n        _this.mainElement.current.style.left = \"\".concat(left > 0 ? left : 0, \"px\");\n      }\n    };\n\n    _this.mainElement = React.createRef();\n    return _this;\n  }\n\n  _createClass(ToolContextMenu, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      if (!this.props.eventData) {\n        return null;\n      }\n\n      var _this$props = this.props,\n          isTouchEvent = _this$props.isTouchEvent,\n          eventData = _this$props.eventData,\n          availableTools = _this$props.availableTools;\n      var dropdownItems = getDropdownItems(eventData, isTouchEvent, availableTools); // Skip if there is no dropdown item\n\n      if (!dropdownItems.length) {\n        return '';\n      }\n\n      var dropdownComponents = dropdownItems.map(function (item) {\n        var itemOnClick = function itemOnClick(event) {\n          item.action(item.params);\n\n          if (_this2.props.onClose) {\n            _this2.props.onClose();\n          }\n        };\n\n        return React.createElement(\"li\", {\n          key: item.actionType,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: \"form-action\",\n          onClick: itemOnClick,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          key: item.actionType,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, item.text)));\n      });\n      var position = {\n        top: \"\".concat(eventData.currentPoints.canvas.y, \"px\"),\n        left: \"\".concat(eventData.currentPoints.canvas.x, \"px\")\n      };\n      return React.createElement(\"div\", {\n        className: \"ToolContextMenu\",\n        style: position,\n        ref: this.mainElement,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(\"ul\", {\n        className: \"bounded\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, dropdownComponents));\n    }\n  }]);\n\n  return ToolContextMenu;\n}(Component);\n\nToolContextMenu.propTypes = {\n  isTouchEvent: PropTypes.bool.isRequired,\n  eventData: PropTypes.object,\n  onClose: PropTypes.func,\n  availableTools: PropTypes.array,\n  visible: PropTypes.bool.isRequired\n};\nToolContextMenu.defaultProps = {\n  visible: true,\n  isTouchEvent: false\n};\nexport default ToolContextMenu;","map":{"version":3,"sources":["/home/bitnami/Viewers/src/connectedComponents/ToolContextMenu.js"],"names":["React","Component","PropTypes","cornerstone","cornerstoneTools","getMeasurementLocationCallback","toolTypes","defaultDropdownItems","actionType","action","nearbyToolData","eventData","element","removeToolState","toolType","tool","updateImage","options","skipAddLabelButton","editLocation","editDescriptionOnDialog","getNearbyToolData","coords","nearbyTool","pointNearTool","forEach","toolData","getToolState","data","index","toolInterface","getToolForElement","Error","undefined","getDropdownItems","isTouchEvent","availableTools","currentPoints","canvas","dropdownItems","item","params","text","description","push","ToolContextMenu","props","componentDidMount","mainElement","current","updateElementPosition","componentDidUpdate","offsetParent","offsetTop","offsetHeight","offsetWidth","offsetLeft","offBoundPixels","top","y","style","left","x","createRef","length","dropdownComponents","map","itemOnClick","event","onClose","position","propTypes","bool","isRequired","object","func","array","visible","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneTools from 'cornerstone-tools';\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback';\n\nimport './ToolContextMenu.css';\n\nconst toolTypes = [\n  'Angle',\n  'Bidirectional',\n  'Length',\n  'FreehandMouse',\n  'EllipticalRoi',\n  'CircleRoi',\n  'RectangleRoi',\n];\n\nlet defaultDropdownItems = [\n  {\n    actionType: 'Delete',\n    action: ({ nearbyToolData, eventData }) => {\n      const element = eventData.element;\n\n      cornerstoneTools.removeToolState(\n        element,\n        nearbyToolData.toolType,\n        nearbyToolData.tool\n      );\n      cornerstone.updateImage(element);\n    },\n  },\n  {\n    actionType: 'setLabel',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData;\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n  },\n  {\n    actionType: 'setDescription',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData;\n\n      const options = {\n        editDescriptionOnDialog: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n  },\n];\n\nfunction getNearbyToolData(element, coords, toolTypes) {\n  const nearbyTool = {};\n  let pointNearTool = false;\n\n  toolTypes.forEach(toolType => {\n    const toolData = cornerstoneTools.getToolState(element, toolType);\n    if (!toolData) {\n      return;\n    }\n\n    toolData.data.forEach(function(data, index) {\n      // TODO: Fix this, it's ugly\n      let toolInterface = cornerstoneTools.getToolForElement(element, toolType);\n      if (!toolInterface) {\n        toolInterface = cornerstoneTools.getToolForElement(\n          element,\n          `${toolType}Tool`\n        );\n      }\n\n      if (!toolInterface) {\n        throw new Error('Tool not found.');\n      }\n\n      if (toolInterface.pointNearTool(element, data, coords)) {\n        pointNearTool = true;\n        nearbyTool.tool = data;\n        nearbyTool.index = index;\n        nearbyTool.toolType = toolType;\n      }\n    });\n\n    if (pointNearTool) {\n      return false;\n    }\n  });\n\n  return pointNearTool ? nearbyTool : undefined;\n}\n\nfunction getDropdownItems(eventData, isTouchEvent = false, availableTools) {\n  const nearbyToolData = getNearbyToolData(\n    eventData.element,\n    eventData.currentPoints.canvas,\n    toolTypes,\n    availableTools\n  );\n\n  // Annotate tools for touch events already have a press handle to edit it, has a better UX for deleting it\n  if (\n    isTouchEvent &&\n    nearbyToolData &&\n    nearbyToolData.toolType === 'arrowAnnotate'\n  ) {\n    return;\n  }\n\n  let dropdownItems = [];\n  if (nearbyToolData) {\n    defaultDropdownItems.forEach(function(item) {\n      item.params = {\n        eventData,\n        nearbyToolData,\n      };\n\n      if (item.actionType === 'Delete') {\n        item.text = 'Delete measurement';\n      }\n\n      if (item.actionType === 'setLabel') {\n        item.text = 'Relabel';\n      }\n\n      if (item.actionType === 'setDescription') {\n        item.text = `${\n          nearbyToolData.tool.description ? 'Edit' : 'Add'\n        } Description`;\n      }\n\n      dropdownItems.push(item);\n    });\n  }\n\n  return dropdownItems;\n}\n\nclass ToolContextMenu extends Component {\n  static propTypes = {\n    isTouchEvent: PropTypes.bool.isRequired,\n    eventData: PropTypes.object,\n    onClose: PropTypes.func,\n    availableTools: PropTypes.array,\n    visible: PropTypes.bool.isRequired,\n  };\n\n  static defaultProps = {\n    visible: true,\n    isTouchEvent: false,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.mainElement = React.createRef();\n  }\n\n  render() {\n    if (!this.props.eventData) {\n      return null;\n    }\n\n    const { isTouchEvent, eventData, availableTools } = this.props;\n    const dropdownItems = getDropdownItems(\n      eventData,\n      isTouchEvent,\n      availableTools\n    );\n\n    // Skip if there is no dropdown item\n    if (!dropdownItems.length) {\n      return '';\n    }\n\n    const dropdownComponents = dropdownItems.map(item => {\n      const itemOnClick = event => {\n        item.action(item.params);\n        if (this.props.onClose) {\n          this.props.onClose();\n        }\n      };\n\n      return (\n        <li key={item.actionType}>\n          <button className=\"form-action\" onClick={itemOnClick}>\n            <span key={item.actionType}>{item.text}</span>\n          </button>\n        </li>\n      );\n    });\n\n    const position = {\n      top: `${eventData.currentPoints.canvas.y}px`,\n      left: `${eventData.currentPoints.canvas.x}px`,\n    };\n\n    return (\n      <div className=\"ToolContextMenu\" style={position} ref={this.mainElement}>\n        <ul className=\"bounded\">{dropdownComponents}</ul>\n      </div>\n    );\n  }\n\n  componentDidMount = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition();\n    }\n  };\n\n  componentDidUpdate = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition();\n    }\n  };\n\n  updateElementPosition = () => {\n    const {\n      offsetParent,\n      offsetTop,\n      offsetHeight,\n      offsetWidth,\n      offsetLeft,\n    } = this.mainElement.current;\n\n    const { eventData } = this.props;\n\n    if (offsetTop + offsetHeight > offsetParent.offsetHeight) {\n      const offBoundPixels =\n        offsetTop + offsetHeight - offsetParent.offsetHeight;\n      const top = eventData.currentPoints.canvas.y - offBoundPixels;\n\n      this.mainElement.current.style.top = `${top > 0 ? top : 0}px`;\n    }\n\n    if (offsetLeft + offsetWidth > offsetParent.offsetWidth) {\n      const offBoundPixels =\n        offsetLeft + offsetWidth - offsetParent.offsetWidth;\n      const left = eventData.currentPoints.canvas.x - offBoundPixels;\n\n      this.mainElement.current.style.left = `${left > 0 ? left : 0}px`;\n    }\n  };\n}\n\nexport default ToolContextMenu;\n"]},"metadata":{},"sourceType":"module"}