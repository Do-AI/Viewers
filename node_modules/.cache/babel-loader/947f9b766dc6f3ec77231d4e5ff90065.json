{"ast":null,"code":"/*! cornerstone-wado-image-loader - 2.2.2 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWADOImageLoader */\n!function (e, t) {\n  \"object\" == typeof exports && \"object\" == typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define(\"cornerstoneWADOImageLoader\", [], t) : \"object\" == typeof exports ? exports.cornerstoneWADOImageLoader = t() : e.cornerstoneWADOImageLoader = t();\n}(this, function () {\n  return function (r) {\n    var a = {};\n\n    function n(e) {\n      if (a[e]) return a[e].exports;\n      var t = a[e] = {\n        i: e,\n        l: !1,\n        exports: {}\n      };\n      return r[e].call(t.exports, t, t.exports, n), t.l = !0, t.exports;\n    }\n\n    return n.m = r, n.c = a, n.d = function (e, t, r) {\n      n.o(e, t) || Object.defineProperty(e, t, {\n        enumerable: !0,\n        get: r\n      });\n    }, n.r = function (e) {\n      \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {\n        value: \"Module\"\n      }), Object.defineProperty(e, \"__esModule\", {\n        value: !0\n      });\n    }, n.t = function (t, e) {\n      if (1 & e && (t = n(t)), 8 & e) return t;\n      if (4 & e && \"object\" == typeof t && t && t.__esModule) return t;\n      var r = Object.create(null);\n      if (n.r(r), Object.defineProperty(r, \"default\", {\n        enumerable: !0,\n        value: t\n      }), 2 & e && \"string\" != typeof t) for (var a in t) {\n        n.d(r, a, function (e) {\n          return t[e];\n        }.bind(null, a));\n      }\n      return r;\n    }, n.n = function (e) {\n      var t = e && e.__esModule ? function () {\n        return e.default;\n      } : function () {\n        return e;\n      };\n      return n.d(t, \"a\", t), t;\n    }, n.o = function (e, t) {\n      return Object.prototype.hasOwnProperty.call(e, t);\n    }, n.p = \"\", n(n.s = 6);\n  }([function (e, t, r) {\n    \"use strict\";\n\n    t.a = function (e) {\n      for (var t, r = e[0], a = e[0], n = e.length, o = 1; o < n; o++) {\n        t = e[o], r = Math.min(r, t), a = Math.max(a, t);\n      }\n\n      return {\n        min: r,\n        max: a\n      };\n    };\n  }, function (e, t, r) {\n    \"use strict\";\n\n    var m;\n\n    function a() {\n      if (\"undefined\" == typeof CharLS) throw new Error(\"No JPEG-LS decoder loaded\");\n      if (!(m || (m = CharLS()) && m._jpegls_decode)) throw new Error(\"JPEG-LS failed to initialize\");\n    }\n\n    r.d(t, \"b\", function () {\n      return a;\n    }), t.a = function (e, t) {\n      a();\n\n      var r = function (e, t) {\n        var r = m._malloc(e.length);\n\n        m.writeArrayToMemory(e, r);\n\n        var a = m._malloc(4),\n            n = m._malloc(4),\n            o = m._malloc(4),\n            i = m._malloc(4),\n            l = m._malloc(4),\n            s = m._malloc(4),\n            u = m._malloc(4),\n            c = m._malloc(4),\n            f = m._malloc(4),\n            d = {\n          result: m.ccall(\"jpegls_decode\", \"number\", [\"number\", \"number\", \"number\", \"number\", \"number\", \"number\", \"number\", \"number\", \"number\", \"number\", \"number\"], [r, e.length, a, n, o, i, l, s, c, u, f]),\n          width: m.getValue(o, \"i32\"),\n          height: m.getValue(i, \"i32\"),\n          bitsPerSample: m.getValue(l, \"i32\"),\n          stride: m.getValue(s, \"i32\"),\n          components: m.getValue(c, \"i32\"),\n          allowedLossyError: m.getValue(u, \"i32\"),\n          interleaveMode: m.getValue(f, \"i32\"),\n          pixelData: void 0\n        },\n            p = m.getValue(a, \"*\");\n\n        return d.bitsPerSample <= 8 ? (d.pixelData = new Uint8Array(d.width * d.height * d.components), d.pixelData.set(new Uint8Array(m.HEAP8.buffer, p, d.pixelData.length))) : t ? (d.pixelData = new Int16Array(d.width * d.height * d.components), d.pixelData.set(new Int16Array(m.HEAP16.buffer, p, d.pixelData.length))) : (d.pixelData = new Uint16Array(d.width * d.height * d.components), d.pixelData.set(new Uint16Array(m.HEAP16.buffer, p, d.pixelData.length))), m._free(r), m._free(p), m._free(a), m._free(n), m._free(o), m._free(i), m._free(l), m._free(s), m._free(c), m._free(f), d;\n      }(t, 1 === e.pixelRepresentation);\n\n      if (0 !== r.result && 6 !== r.result) throw new Error(\"JPEG-LS decoder failed to decode frame (error code \".concat(r.result, \")\"));\n      return e.columns = r.width, e.rows = r.height, e.pixelData = r.pixelData, e;\n    };\n  }, function (e, t, r) {\n    \"use strict\";\n\n    var h;\n\n    function n(e, t) {\n      var r = function (e, t, r) {\n        var a = h._malloc(e.length);\n\n        h.writeArrayToMemory(e, a);\n\n        var n = h._malloc(4),\n            o = h._malloc(4),\n            i = h._malloc(4),\n            l = h._malloc(4),\n            s = h._malloc(4),\n            u = new Date().getTime();\n\n        if (0 !== h.ccall(\"jp2_decode\", \"number\", [\"number\", \"number\", \"number\", \"number\", \"number\", \"number\", \"number\"], [a, e.length, n, o, i, l, s])) return console.log(\"[opj_decode] decoding failed!\"), h._free(a), h._free(h.getValue(n, \"*\")), h._free(i), h._free(l), h._free(o), void h._free(s);\n        var c = h.getValue(n, \"*\"),\n            f = {\n          length: h.getValue(o, \"i32\"),\n          sx: h.getValue(i, \"i32\"),\n          sy: h.getValue(l, \"i32\"),\n          nbChannels: h.getValue(s, \"i32\"),\n          perf_timetodecode: void 0,\n          pixelData: void 0\n        },\n            d = f.sx * f.sy * f.nbChannels,\n            p = new Int32Array(h.HEAP32.buffer, c, d);\n        if (1 === t) {\n          if (Uint8Array.from) f.pixelData = Uint8Array.from(p);else {\n            f.pixelData = new Uint8Array(d);\n\n            for (var m = 0; m < d; m++) {\n              f.pixelData[m] = p[m];\n            }\n          }\n        } else if (r) {\n          if (Int16Array.from) f.pixelData = Int16Array.from(p);else {\n            f.pixelData = new Int16Array(d);\n\n            for (var g = 0; g < d; g++) {\n              f.pixelData[g] = p[g];\n            }\n          }\n        } else if (Uint16Array.from) f.pixelData = Uint16Array.from(p);else {\n          f.pixelData = new Uint16Array(d);\n\n          for (var v = 0; v < d; v++) {\n            f.pixelData[v] = p[v];\n          }\n        }\n        var x = new Date().getTime();\n        return f.perf_timetodecode = x - u, h._free(a), h._free(n), h._free(c), h._free(o), h._free(i), h._free(l), h._free(s), f;\n      }(t, e.bitsAllocated <= 8 ? 1 : 2, 1 === e.pixelRepresentation);\n\n      return e.columns = r.sx, e.rows = r.sy, e.pixelData = r.pixelData, 1 < r.nbChannels && (e.photometricInterpretation = \"RGB\"), e;\n    }\n\n    function o(e) {\n      if (!e.usePDFJS && \"undefined\" == typeof OpenJPEG) throw new Error(\"OpenJPEG decoder not loaded\");\n      if (!(h || (h = OpenJPEG()) && h._jp2_decode)) throw new Error(\"OpenJPEG failed to initialize\");\n    }\n\n    r.d(t, \"b\", function () {\n      return o;\n    }), t.a = function (e, t, r) {\n      var a = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : {};\n      return o(r), a.usePDFJS || r.usePDFJS ? function (e, t) {\n        var r = new JpxImage();\n        r.parse(t);\n        var a = r.tiles.length;\n        if (1 !== a) throw new Error(\"JPEG2000 decoder returned a tileCount of \".concat(a, \", when 1 is expected\"));\n        return e.columns = r.width, e.rows = r.height, e.pixelData = r.tiles[0].items, e;\n      }(e, t) : n(e, t);\n    };\n  }, function (e, t, r) {\n    \"use strict\";\n\n    t.a = \"2.2.2\";\n  }, function (e, t, r) {\n    \"use strict\";\n\n    r.d(t, \"a\", function () {\n      return a;\n    });\n    var n = r(0);\n\n    function a(e) {\n      var t = !(1 < arguments.length && void 0 !== arguments[1]) || arguments[1],\n          r = Object(n.a)(e.pixelData),\n          a = !(o(e.smallestPixelValue) && o(e.largestPixelValue));\n      !0 !== t || a ? (e.smallestPixelValue = r.min, e.largestPixelValue = r.max) : (e.smallestPixelValue !== r.min && console.warn(\"Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably.\"), e.largestPixelValue !== r.max && console.warn(\"Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably.\"));\n    }\n\n    function o(e) {\n      return \"number\" == typeof e;\n    }\n  }, function (e, t, r) {\n    \"use strict\";\n\n    var c = function c(e, t) {\n      var r = t.buffer,\n          a = t.byteOffset,\n          n = t.length;\n      return 16 === e.bitsAllocated ? (a % 2 && (r = r.slice(a), a = 0), 0 === e.pixelRepresentation ? e.pixelData = new Uint16Array(r, a, n / 2) : e.pixelData = new Int16Array(r, a, n / 2)) : 8 === e.bitsAllocated || 1 === e.bitsAllocated ? e.pixelData = t : 32 === e.bitsAllocated && (a % 2 && (r = r.slice(a), a = 0), e.pixelData = new Float32Array(r, a, n / 4)), e;\n    };\n\n    var f = function f(e, t) {\n      if (16 === e.bitsAllocated) {\n        var r = t.buffer,\n            a = t.byteOffset,\n            n = t.length;\n        a % 2 && (r = r.slice(a), a = 0), 0 === e.pixelRepresentation ? e.pixelData = new Uint16Array(r, a, n / 2) : e.pixelData = new Int16Array(r, a, n / 2);\n\n        for (var o = 0; o < e.pixelData.length; o++) {\n          e.pixelData[o] = (255 & (i = e.pixelData[o])) << 8 | i >> 8 & 255;\n        }\n      } else 8 === e.bitsAllocated && (e.pixelData = t);\n\n      var i;\n      return e;\n    };\n\n    var d = function d(e, t) {\n      if (8 === e.bitsAllocated) return e.planarConfiguration ? function (e, t) {\n        for (var r = t, a = e.rows * e.columns, n = new ArrayBuffer(a * e.samplesPerPixel), o = new DataView(r.buffer, r.byteOffset), i = new Int8Array(r.buffer, r.byteOffset), l = new Int8Array(n), s = 0, u = o.getInt32(0, !0), c = 0; c < u; ++c) {\n          s = c * a;\n          var f = o.getInt32(4 * (c + 1), !0),\n              d = o.getInt32(4 * (c + 2), !0);\n          0 === d && (d = r.length);\n\n          for (var p = a * u; f < d;) {\n            var m = i[f++];\n            if (0 <= m && m <= 127) for (var g = 0; g < m + 1 && s < p; ++g) {\n              l[s] = i[f++], s++;\n            } else if (m <= -1 && -127 <= m) for (var v = i[f++], x = 0; x < 1 - m && s < p; ++x) {\n              l[s] = v, s++;\n            }\n          }\n        }\n\n        return e.pixelData = new Uint8Array(n), e;\n      }(e, t) : function (e, t) {\n        for (var r = t, a = e.rows * e.columns, n = new ArrayBuffer(a * e.samplesPerPixel), o = new DataView(r.buffer, r.byteOffset), i = new Int8Array(r.buffer, r.byteOffset), l = new Int8Array(n), s = 0, u = o.getInt32(0, !0), c = 0; c < u; ++c) {\n          s = c;\n          var f = o.getInt32(4 * (c + 1), !0),\n              d = o.getInt32(4 * (c + 2), !0);\n          0 === d && (d = r.length);\n\n          for (var p = a * u; f < d;) {\n            var m = i[f++];\n            if (0 <= m && m <= 127) for (var g = 0; g < m + 1 && s < p; ++g) {\n              l[s] = i[f++], s += e.samplesPerPixel;\n            } else if (m <= -1 && -127 <= m) for (var v = i[f++], x = 0; x < 1 - m && s < p; ++x) {\n              l[s] = v, s += e.samplesPerPixel;\n            }\n          }\n        }\n\n        return e.pixelData = new Uint8Array(n), e;\n      }(e, t);\n      if (16 === e.bitsAllocated) return function (e, t) {\n        for (var r = t, a = e.rows * e.columns, n = new ArrayBuffer(a * e.samplesPerPixel * 2), o = new DataView(r.buffer, r.byteOffset), i = new Int8Array(r.buffer, r.byteOffset), l = new Int8Array(n), s = o.getInt32(0, !0), u = 0; u < s; ++u) {\n          var c = 0,\n              f = 0 === u ? 1 : 0,\n              d = o.getInt32(4 * (u + 1), !0),\n              p = o.getInt32(4 * (u + 2), !0);\n\n          for (0 === p && (p = r.length); d < p;) {\n            var m = i[d++];\n            if (0 <= m && m <= 127) for (var g = 0; g < m + 1 && c < a; ++g) {\n              l[2 * c + f] = i[d++], c++;\n            } else if (m <= -1 && -127 <= m) for (var v = i[d++], x = 0; x < 1 - m && c < a; ++x) {\n              l[2 * c + f] = v, c++;\n            }\n          }\n        }\n\n        return 0 === e.pixelRepresentation ? e.pixelData = new Uint16Array(n) : e.pixelData = new Int16Array(n), e;\n      }(e, t);\n      throw new Error(\"unsupported pixel format for RLE\");\n    };\n\n    var p = function p(e, t) {\n      if (\"undefined\" == typeof JpegImage) throw new Error(\"No JPEG Baseline decoder loaded\");\n      var r = new JpegImage();\n      return r.parse(t), r.colorTransform = !1, 8 === e.bitsAllocated ? (e.pixelData = r.getData(e.columns, e.rows), e) : 16 === e.bitsAllocated ? (e.pixelData = r.getData16(e.columns, e.rows), e) : void 0;\n    };\n\n    var m = function m(e, t) {\n      if (\"undefined\" == typeof jpeg || void 0 === jpeg.lossless || void 0 === jpeg.lossless.Decoder) throw new Error(\"No JPEG Lossless decoder loaded\");\n      var r = e.bitsAllocated <= 8 ? 1 : 2,\n          a = t.buffer,\n          n = new jpeg.lossless.Decoder().decode(a, t.byteOffset, t.length, r);\n      return 0 === e.pixelRepresentation ? 16 === e.bitsAllocated ? e.pixelData = new Uint16Array(n.buffer) : e.pixelData = new Uint8Array(n.buffer) : e.pixelData = new Int16Array(n.buffer), e;\n    },\n        g = r(1),\n        v = r(2);\n\n    t.a = function (e, t, r, a, n) {\n      var o = new Date().getTime();\n      if (\"1.2.840.10008.1.2\" === t) e = c(e, r);else if (\"1.2.840.10008.1.2.1\" === t) e = c(e, r);else if (\"1.2.840.10008.1.2.2\" === t) e = f(e, r);else if (\"1.2.840.10008.1.2.1.99\" === t) e = c(e, r);else if (\"1.2.840.10008.1.2.5\" === t) e = d(e, r);else if (\"1.2.840.10008.1.2.4.50\" === t) e = p(e, r);else if (\"1.2.840.10008.1.2.4.51\" === t) e = p(e, r);else if (\"1.2.840.10008.1.2.4.57\" === t) e = m(e, r);else if (\"1.2.840.10008.1.2.4.70\" === t) e = m(e, r);else if (\"1.2.840.10008.1.2.4.80\" === t) e = Object(g.a)(e, r);else if (\"1.2.840.10008.1.2.4.81\" === t) e = Object(g.a)(e, r);else if (\"1.2.840.10008.1.2.4.90\" === t) e = Object(v.a)(e, r, a, n);else {\n        if (\"1.2.840.10008.1.2.4.91\" !== t) throw new Error(\"no decoder for transfer syntax \".concat(t));\n        e = Object(v.a)(e, r, a, n);\n      }\n      var i = void 0 !== e.pixelRepresentation && 1 === e.pixelRepresentation,\n          l = i && void 0 !== e.bitsStored ? 32 - e.bitsStored : void 0;\n      if (i && void 0 !== l) for (var s = 0; s < e.pixelData.length; s++) {\n        e.pixelData[s] = e.pixelData[s] << l >> l;\n      }\n      var u = new Date().getTime();\n      return e.decodeTimeInMS = u - o, e;\n    };\n  }, function (e, t, r) {\n    \"use strict\";\n\n    r.r(t);\n\n    var a = function a(e, t) {\n      if (void 0 === e) throw new Error(\"decodeRGB: rgbBuffer must not be undefined\");\n      if (e.length % 3 != 0) throw new Error(\"decodeRGB: rgbBuffer length must be divisible by 3\");\n\n      for (var r = e.length / 3, a = 0, n = 0, o = 0; o < r; o++) {\n        t[n++] = e[a++], t[n++] = e[a++], t[n++] = e[a++], t[n++] = 255;\n      }\n    },\n        n = function n(e, t) {\n      if (void 0 === e) throw new Error(\"decodeRGB: rgbBuffer must not be undefined\");\n      if (e.length % 3 != 0) throw new Error(\"decodeRGB: rgbBuffer length must be divisible by 3\");\n\n      for (var r = e.length / 3, a = 0, n = 0, o = r, i = 2 * r, l = 0; l < r; l++) {\n        t[a++] = e[n++], t[a++] = e[o++], t[a++] = e[i++], t[a++] = 255;\n      }\n    },\n        o = function o(e, t) {\n      if (void 0 === e) throw new Error(\"decodeRGB: ybrBuffer must not be undefined\");\n      if (e.length % 3 != 0) throw new Error(\"decodeRGB: ybrBuffer length must be divisble by 3\");\n\n      for (var r = e.length / 3, a = 0, n = 0, o = 0; o < r; o++) {\n        var i = e[a++],\n            l = e[a++],\n            s = e[a++];\n        t[n++] = i + 1.402 * (s - 128), t[n++] = i - .34414 * (l - 128) - .71414 * (s - 128), t[n++] = i + 1.772 * (l - 128), t[n++] = 255;\n      }\n    },\n        i = function i(e, t) {\n      if (void 0 === e) throw new Error(\"decodeRGB: ybrBuffer must not be undefined\");\n      if (e.length % 3 != 0) throw new Error(\"decodeRGB: ybrBuffer length must be divisble by 3\");\n\n      for (var r = e.length / 3, a = 0, n = 0, o = r, i = 2 * r, l = 0; l < r; l++) {\n        var s = e[n++],\n            u = e[o++],\n            c = e[i++];\n        t[a++] = s + 1.402 * (c - 128), t[a++] = s - .34414 * (u - 128) - .71414 * (c - 128), t[a++] = s + 1.772 * (u - 128), t[a++] = 255;\n      }\n    };\n\n    function x(e, t) {\n      for (var r = e.length, a = new Uint8ClampedArray(r), n = 0; n < r; ++n) {\n        a[n] = e[n] >> t;\n      }\n\n      return a;\n    }\n\n    var l = function l(e, t) {\n      for (var r = e.columns * e.rows, a = e.pixelData, n = e.redPaletteColorLookupTableData, o = e.greenPaletteColorLookupTableData, i = e.bluePaletteColorLookupTableData, l = e.redPaletteColorLookupTableData.length, s = 0, u = 0, c = e.redPaletteColorLookupTableDescriptor[1], f = 8 === e.redPaletteColorLookupTableDescriptor[2] ? 0 : 8, d = x(n, f), p = x(o, f), m = x(i, f), g = 0; g < r; ++g) {\n        var v = a[s++];\n        v < c ? v = 0 : c + l - 1 < v ? v = l - 1 : v -= c, t[u++] = d[v], t[u++] = p[v], t[u++] = m[v], t[u++] = 255;\n      }\n    };\n\n    function s(e, t) {\n      if (e.elements[t] && 6 === e.elements[t].length) return [e.uint16(t, 0), e.uint16(t, 1), e.uint16(t, 2)];\n    }\n\n    function u(e, t, r) {\n      for (var a = [], n = e.elements[t], o = 0; o < r[0]; o++) {\n        16 === r[2] ? a[o] = e.uint16(t, o) : a[o] = e.byteArray[o + n.dataOffset];\n      }\n\n      return a;\n    }\n\n    var g = function g(e) {\n      var t,\n          r,\n          a,\n          n = {\n        samplesPerPixel: e.uint16(\"x00280002\"),\n        photometricInterpretation: e.string(\"x00280004\"),\n        rows: e.uint16(\"x00280010\"),\n        columns: e.uint16(\"x00280011\"),\n        bitsAllocated: e.uint16(\"x00280100\"),\n        bitsStored: e.uint16(\"x00280101\"),\n        highBit: e.uint16(\"x00280102\"),\n        pixelRepresentation: e.uint16(\"x00280103\"),\n        planarConfiguration: e.uint16(\"x00280006\"),\n        pixelAspectRatio: e.string(\"x00280034\")\n      };\n      return r = n, a = (t = e).uint16(\"x00280103\"), r.largestPixelValue = 0 === a ? (r.smallestPixelValue = t.uint16(\"x00280106\"), t.uint16(\"x00280107\")) : (r.smallestPixelValue = t.int16(\"x00280106\"), t.int16(\"x00280107\")), \"PALETTE COLOR\" === n.photometricInterpretation && e.elements.x00281101 && function (e, t) {\n        t.redPaletteColorLookupTableDescriptor = s(e, \"x00281101\"), t.greenPaletteColorLookupTableDescriptor = s(e, \"x00281102\"), t.bluePaletteColorLookupTableDescriptor = s(e, \"x00281103\"), 0 === t.redPaletteColorLookupTableDescriptor[0] && (t.redPaletteColorLookupTableDescriptor[0] = 65536, t.greenPaletteColorLookupTableDescriptor[0] = 65536, t.bluePaletteColorLookupTableDescriptor[0] = 65536);\n        var r = t.redPaletteColorLookupTableDescriptor[0],\n            a = e.elements.x00281201.length === r ? 8 : 16;\n        t.redPaletteColorLookupTableDescriptor[2] !== a && (t.redPaletteColorLookupTableDescriptor[2] = a, t.greenPaletteColorLookupTableDescriptor[2] = a, t.bluePaletteColorLookupTableDescriptor[2] = a), t.redPaletteColorLookupTableData = u(e, \"x00281201\", t.redPaletteColorLookupTableDescriptor), t.greenPaletteColorLookupTableData = u(e, \"x00281202\", t.greenPaletteColorLookupTableDescriptor), t.bluePaletteColorLookupTableData = u(e, \"x00281203\", t.bluePaletteColorLookupTableDescriptor);\n      }(e, n), n;\n    };\n\n    function c(e, t) {\n      var r = t.uint16(\"x00283002\", 0);\n      0 === r && (r = 65535);\n\n      for (var a = {\n        id: \"1\",\n        firstValueMapped: 0 === e ? t.uint16(\"x00283002\", 1) : t.int16(\"x00283002\", 1),\n        numBitsPerEntry: t.uint16(\"x00283002\", 2),\n        lut: []\n      }, n = 0; n < r; n++) {\n        a.lut[n] = 0 === e ? t.uint16(\"x00283006\", n) : t.int16(\"x00283006\", n);\n      }\n\n      return a;\n    }\n\n    var v = function v(e, t) {\n      if (t && t.items.length) {\n        for (var r = [], a = 0; a < t.items.length; a++) {\n          var n = c(e, t.items[a].dataSet);\n          n && r.push(n);\n        }\n\n        return r;\n      }\n    };\n\n    var h = function h(e) {\n      var t = e.string(\"x00080016\");\n      if (\"1.2.840.10008.5.1.4.1.1.2\" === t || \"1.2.840.10008.5.1.4.1.1.2.1\" === t) return 1;\n      var r,\n          a,\n          n,\n          o = e.floatString(\"x00281052\"),\n          i = e.floatString(\"x00281053\");\n      return void 0 === o || void 0 === i ? e.elements.x00283000 && 0 < e.elements.x00283000.length ? 0 : e.uint16(\"x00280103\") : (a = (r = e).uint16(\"x00280103\"), n = r.uint16(\"x00280101\"), (0 === a ? 0 : -1 << n - 1) * i + o < 0 ? 1 : 0);\n    };\n\n    var w = function w(e, t, r) {\n      var a = [],\n          n = e.string(t);\n\n      if (n) {\n        var o = n.split(\"\\\\\");\n\n        if (!(r && o.length < r)) {\n          for (var i = 0; i < o.length; i++) {\n            a.push(parseFloat(o[i]));\n          }\n\n          return a;\n        }\n      }\n    };\n\n    var d = function d(e, t, r) {\n      return t = t || 0, e && e.Value ? e.Value.length <= t ? r : e.Value[t] : r;\n    };\n\n    var f = function f(e, t, r) {\n      var a = d(e, t, r);\n      if (void 0 !== a) return parseFloat(a);\n    };\n\n    var p = function p(e, t) {\n      var r = d(e, t);\n      if (void 0 !== r) return parseFloat(r);\n    };\n\n    var m = function m(e, t) {\n      if (e && e.Value && !(t && e.Value.length < t)) {\n        for (var r = [], a = 0; a < e.Value.length; a++) {\n          r.push(parseFloat(e.Value[a]));\n        }\n\n        return r;\n      }\n    },\n        b = [];\n\n    var y = {\n      add: function add(e, t) {\n        b[e] = t;\n      },\n      get: function get(e) {\n        return b[e];\n      },\n      remove: function remove(e) {\n        b[e] = void 0;\n      },\n      purge: function purge() {\n        b = [];\n      }\n    };\n\n    var P = function P(e, t) {\n      var r = fe.dicomParser,\n          a = y.get(t);\n\n      if (a) {\n        if (\"generalSeriesModule\" === e) return {\n          modality: d(a[\"00080060\"]),\n          seriesInstanceUID: d(a[\"0020000e\"]),\n          seriesNumber: p(a[\"00200011\"]),\n          studyInstanceUID: d(a[\"0020000d\"]),\n          seriesDate: r.parseDA(d(a[\"00080021\"])),\n          seriesTime: r.parseTM(d(a[\"00080031\"], 0, \"\"))\n        };\n        if (\"patientStudyModule\" === e) return {\n          patientAge: p(a[\"00101010\"]),\n          patientSize: p(a[\"00101020\"]),\n          patientWeight: p(a[\"00101030\"])\n        };\n\n        if (\"imagePlaneModule\" === e) {\n          var n = m(a[\"00200037\"], 6),\n              o = m(a[\"00200032\"], 3),\n              i = m(a[\"00280030\"], 2),\n              l = null,\n              s = null;\n          i && (s = i[0], l = i[1]);\n          var u = null,\n              c = null;\n          return n && (u = [parseFloat(n[0]), parseFloat(n[1]), parseFloat(n[2])], c = [parseFloat(n[3]), parseFloat(n[4]), parseFloat(n[5])]), {\n            frameOfReferenceUID: d(a[\"00200052\"]),\n            rows: p(a[\"00280010\"]),\n            columns: p(a[\"00280011\"]),\n            imageOrientationPatient: n,\n            rowCosines: u,\n            columnCosines: c,\n            imagePositionPatient: o,\n            sliceThickness: p(a[\"00180050\"]),\n            sliceLocation: p(a[\"00201041\"]),\n            pixelSpacing: i,\n            rowPixelSpacing: s,\n            columnPixelSpacing: l\n          };\n        }\n\n        if (\"imagePixelModule\" === e) return {\n          samplesPerPixel: p(a[\"00280002\"]),\n          photometricInterpretation: d(a[\"00280004\"]),\n          rows: p(a[\"00280010\"]),\n          columns: p(a[\"00280011\"]),\n          bitsAllocated: p(a[\"00280100\"]),\n          bitsStored: p(a[\"00280101\"]),\n          highBit: d(a[\"00280102\"]),\n          pixelRepresentation: p(a[\"00280103\"]),\n          planarConfiguration: p(a[\"00280006\"]),\n          pixelAspectRatio: d(a[\"00280034\"]),\n          smallestPixelValue: p(a[\"00280106\"]),\n          largestPixelValue: p(a[\"00280107\"]),\n          redPaletteColorLookupTableDescriptor: m(a[\"00281101\"]),\n          greenPaletteColorLookupTableDescriptor: m(a[\"00281102\"]),\n          bluePaletteColorLookupTableDescriptor: m(a[\"00281103\"]),\n          redPaletteColorLookupTableData: m(a[\"00281201\"]),\n          greenPaletteColorLookupTableData: m(a[\"00281202\"]),\n          bluePaletteColorLookupTableData: m(a[\"00281203\"])\n        };\n        if (\"voiLutModule\" === e) return {\n          windowCenter: m(a[\"00281050\"], 1),\n          windowWidth: m(a[\"00281051\"], 1)\n        };\n        if (\"modalityLutModule\" === e) return {\n          rescaleIntercept: p(a[\"00281052\"]),\n          rescaleSlope: p(a[\"00281053\"]),\n          rescaleType: d(a[\"00281054\"])\n        };\n        if (\"sopCommonModule\" === e) return {\n          sopClassUID: d(a[\"00080016\"]),\n          sopInstanceUID: d(a[\"00080018\"])\n        };\n\n        if (\"petIsotopeModule\" === e) {\n          var f = d(a[\"00540016\"]);\n          if (void 0 === f) return;\n          return {\n            radiopharmaceuticalInfo: {\n              radiopharmaceuticalStartTime: r.parseTM(d(f[\"00181072\"], 0, \"\")),\n              radionuclideTotalDose: p(f[\"00181074\"]),\n              radionuclideHalfLife: p(f[\"00181075\"])\n            }\n          };\n        }\n      }\n    };\n\n    function D(e, t, r) {\n      if (r + e.length > t.length) return !1;\n\n      for (var a = r, n = 0; n < e.length; n++) {\n        if (e[n] !== t[a++]) return !1;\n      }\n\n      return !0;\n    }\n\n    var I = function I(e, t, r) {\n      r = r || 0;\n\n      for (var a = function (e) {\n        for (var t = new Uint8Array(e.length), r = 0, a = e.length; r < a; r++) {\n          t[r] = e.charCodeAt(r);\n        }\n\n        return t;\n      }(t), n = r; n < e.length; n++) {\n        if (a[0] === e[n] && D(a, e, n)) return n;\n      }\n\n      return -1;\n    },\n        T = {\n      beforeSend: function beforeSend() {},\n      imageCreated: function imageCreated() {},\n      strict: !1,\n      useWebWorkers: !0,\n      decodeConfig: {\n        usePDFJS: !1\n      }\n    };\n\n    function C(e) {\n      T = Object.assign(T, e);\n    }\n\n    function k() {\n      return T;\n    }\n\n    var A = function A(o, i) {\n      var n = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : {},\n          l = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : {},\n          s = fe.cornerstone,\n          u = k();\n      return new Promise(function (t, r) {\n        var a = new XMLHttpRequest();\n        a.open(\"get\", o, !0), a.responseType = \"arraybuffer\", u.beforeSend(a, i, n, l), Object.keys(n).forEach(function (e) {\n          a.setRequestHeader(e, n[e]);\n        }), l.deferred = {\n          resolve: t,\n          reject: r\n        }, l.url = o, l.imageId = i, a.onloadstart = function (e) {\n          u.onloadstart && u.onloadstart(e, l);\n          var t = {\n            url: o,\n            imageId: i\n          };\n          s.triggerEvent(s.events, \"cornerstoneimageloadstart\", t);\n        }, a.onloadend = function (e) {\n          u.onloadend && u.onloadend(e, l);\n          var t = {\n            url: o,\n            imageId: i\n          };\n          s.triggerEvent(s.events, \"cornerstoneimageloadend\", t);\n        }, a.onreadystatechange = function (e) {\n          u.onreadystatechange ? u.onreadystatechange(e, l) : 4 === a.readyState && (200 === a.status ? t(a.response, a) : r(a));\n        }, a.onprogress = function (e) {\n          var t,\n              r,\n              a = e.loaded;\n          e.lengthComputable && (t = e.total, r = Math.round(a / t * 100)), u.onprogress && u.onprogress(e, l);\n          var n = {\n            url: o,\n            imageId: i,\n            loaded: a,\n            total: t,\n            percentComplete: r\n          };\n          s.triggerEvent(s.events, \"cornerstoneimageloadprogress\", n);\n        }, a.send();\n      });\n    },\n        L = {\n      xhrRequest: A,\n      setOptions: C,\n      getOptions: k\n    };\n\n    var S = function S(e, t) {\n      var r = {\n        accept: 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : \"application/octet-stream\"\n      };\n      return new Promise(function (s, u) {\n        A(e, t, r).then(function (e) {\n          var t = new Uint8Array(e),\n              r = I(t, \"\\r\\n\\r\\n\");\n          -1 === r && u(new Error(\"invalid response - no multipart mime header\"));\n\n          var a = function (e, t, r) {\n            t = t || 0, r = r || e.length - t;\n\n            for (var a = \"\", n = t; n < t + r; n++) {\n              a += String.fromCharCode(e[n]);\n            }\n\n            return a;\n          }(t, 0, r).split(\"\\r\\n\"),\n              n = function (e) {\n            for (var t = 0; t < e.length; t++) {\n              if (\"--\" === e[t].substr(0, 2)) return e[t];\n            }\n          }(a);\n\n          n || u(new Error(\"invalid response - no boundary marker\"));\n          var o = r + 4,\n              i = I(t, n, o);\n          -1 === i && u(new Error(\"invalid response - terminating boundary not found\"));\n          var l = i - o - 2;\n          s({\n            contentType: function (e) {\n              for (var t = 0; t < e.length; t++) {\n                if (\"Content-Type:\" === e[t].substr(0, 13)) return e[t].substr(13).trim();\n              }\n            }(a),\n            imageFrame: {\n              pixelData: new Uint8Array(e, o, l)\n            }\n          });\n        });\n      });\n    };\n\n    var E,\n        O = function O(e) {\n      var t = fe.cornerstone.metaData.get(\"imagePixelModule\", e);\n      return {\n        samplesPerPixel: t.samplesPerPixel,\n        photometricInterpretation: t.photometricInterpretation,\n        planarConfiguration: t.planarConfiguration,\n        rows: t.rows,\n        columns: t.columns,\n        bitsAllocated: t.bitsAllocated,\n        bitsStored: t.bitsStored,\n        pixelRepresentation: t.pixelRepresentation,\n        smallestPixelValue: t.smallestPixelValue,\n        largestPixelValue: t.largestPixelValue,\n        redPaletteColorLookupTableDescriptor: t.redPaletteColorLookupTableDescriptor,\n        greenPaletteColorLookupTableDescriptor: t.greenPaletteColorLookupTableDescriptor,\n        bluePaletteColorLookupTableDescriptor: t.bluePaletteColorLookupTableDescriptor,\n        redPaletteColorLookupTableData: t.redPaletteColorLookupTableData,\n        greenPaletteColorLookupTableData: t.greenPaletteColorLookupTableData,\n        bluePaletteColorLookupTableData: t.bluePaletteColorLookupTableData,\n        pixelData: void 0\n      };\n    },\n        M = 0,\n        B = [],\n        R = [],\n        _ = k(),\n        W = {\n      maxWebWorkers: navigator.hardwareConcurrency || 1,\n      startWebWorkersOnDemand: !0,\n      webWorkerPath: \"../../dist/cornerstoneWADOImageLoaderWebWorker.js\",\n      webWorkerTaskPaths: [],\n      taskConfiguration: {\n        decodeTask: {\n          loadCodecsOnStartup: !0,\n          initializeCodecsOnStartup: !1,\n          codecsPath: \"../dist/cornerstoneWADOImageLoaderCodecs.js\",\n          usePDFJS: !1,\n          strict: _.strict\n        }\n      }\n    },\n        U = {\n      maxWebWorkers: 0,\n      numWebWorkers: 0,\n      numTasksQueued: 0,\n      numTasksExecuting: 0,\n      numTasksCompleted: 0,\n      totalTaskTimeInMS: 0,\n      totalTimeDelayedInMS: 0\n    };\n\n    function V() {\n      if (B.length) {\n        for (var e = 0; e < R.length; e++) {\n          if (\"ready\" === R[e].status) {\n            R[e].status = \"busy\";\n            var t = B.shift();\n            t.start = new Date().getTime();\n            var r = new Date().getTime();\n            return U.totalTimeDelayedInMS += r - t.added, R[e].task = t, R[e].worker.postMessage({\n              taskType: t.taskType,\n              workerIndex: e,\n              data: t.data\n            }, t.transferList), void U.numTasksExecuting++;\n          }\n        }\n\n        R.length < E.maxWebWorkers && j();\n      }\n    }\n\n    function F(e) {\n      if (\"initialize\" === e.data.taskType) R[e.data.workerIndex].status = \"ready\", V();else {\n        var t = R[e.data.workerIndex].task.start;\n        R[e.data.workerIndex].task.deferred.resolve(e.data.result), R[e.data.workerIndex].task = void 0, U.numTasksExecuting--, R[e.data.workerIndex].status = \"ready\", U.numTasksCompleted++;\n        var r = new Date().getTime();\n        U.totalTaskTimeInMS += r - t, V();\n      }\n    }\n\n    function j() {\n      if (!(R.length >= E.maxWebWorkers)) {\n        var e = new Worker(E.webWorkerPath);\n        R.push({\n          worker: e,\n          status: \"initializing\"\n        }), e.addEventListener(\"message\", F), e.postMessage({\n          taskType: \"initialize\",\n          workerIndex: R.length - 1,\n          config: E\n        });\n      }\n    }\n\n    function G(e) {\n      if (e = e || W, E) throw new Error(\"WebWorkerManager already initialized\");\n      if ((E = e).maxWebWorkers = E.maxWebWorkers || navigator.hardwareConcurrency || 1, !E.startWebWorkersOnDemand) for (var t = 0; t < E.maxWebWorkers; t++) {\n        j();\n      }\n    }\n\n    var J = {\n      initialize: G,\n      loadWebWorkerTask: function loadWebWorkerTask(e, t) {\n        E.webWorkerTaskPaths.push(e), t && (E.taskConfiguration = Object.assign(E.taskConfiguration, t));\n\n        for (var r = 0; r < R.length; r++) {\n          R[r].worker.postMessage({\n            taskType: \"loadWebWorkerTask\",\n            workerIndex: R.length - 1,\n            sourcePath: e,\n            config: E\n          });\n        }\n      },\n      addTask: function addTask(e, t) {\n        var r = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0,\n            a = 3 < arguments.length ? arguments[3] : void 0;\n        E || G();\n        var n,\n            o = {},\n            i = new Promise(function (e, t) {\n          o = {\n            resolve: e,\n            reject: t\n          };\n        });\n\n        for (n = 0; n < B.length && !(B[n].priority < r); n++) {\n          ;\n        }\n\n        var l = M++;\n        return B.splice(n, 0, {\n          taskId: l,\n          taskType: e,\n          status: \"ready\",\n          added: new Date().getTime(),\n          data: t,\n          deferred: o,\n          priority: r,\n          transferList: a\n        }), V(), {\n          taskId: l,\n          promise: i\n        };\n      },\n      getStatistics: function getStatistics() {\n        return U.maxWebWorkers = E.maxWebWorkers, U.numWebWorkers = R.length, U.numTasksQueued = B.length, U;\n      },\n      setTaskPriority: function setTaskPriority(e) {\n        for (var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0, r = 0; r < B.length; r++) {\n          if (B[r].taskId === e) {\n            var a = B.splice(r, 1)[0];\n\n            for (a.priority = t, r = 0; r < B.length && !(B[r].priority < t); r++) {\n              ;\n            }\n\n            return B.splice(r, 0, a), !0;\n          }\n        }\n\n        return !1;\n      },\n      cancelTask: function cancelTask(e, t) {\n        for (var r = 0; r < B.length; r++) {\n          if (B[r].taskId === e) return B.splice(r, 1).deferred.reject(t), !0;\n        }\n\n        return !1;\n      }\n    },\n        z = r(0);\n\n    function q(e) {\n      return function (t) {\n        var r;\n\n        try {\n          return decodeURIComponent(escape(t));\n        } catch (e) {\n          if ((r = e) instanceof URIError) return t;\n          throw r;\n        }\n      }(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(e))));\n    }\n\n    var Y = function Y(i, e, l) {\n      var s = new Date().getTime(),\n          r = new Blob([e], {\n        type: \"image/jpeg\"\n      });\n      return new Promise(function (o, t) {\n        var e = new FileReader();\n        void 0 === e.readAsBinaryString ? e.readAsArrayBuffer(r) : e.readAsBinaryString(r), e.onload = function () {\n          var n = new Image();\n          n.onload = function () {\n            l.height = n.height, l.width = n.width, i.rows = n.height, i.columns = n.width;\n            var e = l.getContext(\"2d\");\n            e.drawImage(this, 0, 0);\n            var t = e.getImageData(0, 0, n.width, n.height),\n                r = new Date().getTime();\n            i.pixelData = t.data, i.imageData = t, i.decodeTimeInMS = r - s;\n            var a = Object(z.a)(i.pixelData);\n            i.smallestPixelValue = a.min, i.largestPixelValue = a.max, o(i);\n          }, n.onerror = function (e) {\n            t(e);\n          }, void 0 === e.readAsBinaryString ? n.src = \"data:image/jpeg;base64,\".concat(window.btoa(q(e.result))) : n.src = \"data:image/jpeg;base64,\".concat(window.btoa(e.result));\n        }, e.onerror = function (e) {\n          t(e);\n        };\n      });\n    },\n        N = r(5),\n        H = r(4),\n        K = r(2),\n        Q = r(1),\n        X = !1;\n\n    function Z(n, o, i, l) {\n      var e = l.priority || void 0,\n          t = l.transferPixelData ? [i.buffer] : void 0,\n          r = k(),\n          s = r.strict,\n          u = r.decodeConfig;\n      return !1 === r.useWebWorkers ? (!1 === X && (Object(K.b)(u), Object(Q.b)(u), X = !0), new Promise(function (e, t) {\n        try {\n          var r = [n, o, i, u, l],\n              a = N.a.apply(void 0, r);\n          Object(H.a)(a, s), e(a);\n        } catch (e) {\n          t(e);\n        }\n      })) : J.addTask(\"decodeTask\", {\n        imageFrame: n,\n        transferSyntax: o,\n        pixelData: i,\n        options: l\n      }, e, t).promise;\n    }\n\n    var $ = function $(e, r, t, a) {\n      var n = 4 < arguments.length && void 0 !== arguments[4] ? arguments[4] : {};\n      return \"1.2.840.10008.1.2\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.1\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.2\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.1.99\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.5\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.50\" === r ? 8 !== e.bitsAllocated || 3 !== e.samplesPerPixel && 4 !== e.samplesPerPixel ? Z(e, r, t, n) : Y(e, t, a) : \"1.2.840.10008.1.2.4.51\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.57\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.70\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.80\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.81\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.90\" === r ? Z(e, r, t, n) : \"1.2.840.10008.1.2.4.91\" === r ? Z(e, r, t, n) : new Promise(function (e, t) {\n        t(new Error(\"No decoder for transfer syntax \".concat(r)));\n      });\n    },\n        ee = function ee(e) {\n      return \"RGB\" === e || \"PALETTE COLOR\" === e || \"YBR_FULL\" === e || \"YBR_FULL_422\" === e || \"YBR_PARTIAL_422\" === e || \"YBR_PARTIAL_420\" === e || \"YBR_RCT\" === e || \"YBR_ICT\" === e;\n    };\n\n    function te(e, t) {\n      0 === e.planarConfiguration ? a(e.pixelData, t) : n(e.pixelData, t);\n    }\n\n    function re(e, t) {\n      var r,\n          a,\n          n = t.data;\n      if (\"RGB\" === e.photometricInterpretation) te(e, n);else if (\"YBR_RCT\" === e.photometricInterpretation) te(e, n);else if (\"YBR_ICT\" === e.photometricInterpretation) te(e, n);else if (\"PALETTE COLOR\" === e.photometricInterpretation) l(e, n);else if (\"YBR_FULL_422\" === e.photometricInterpretation) te(e, n);else {\n        if (\"YBR_FULL\" !== e.photometricInterpretation) throw new Error(\"No color space conversion for photometric interpretation \".concat(e.photometricInterpretation));\n        a = n, 0 === (r = e).planarConfiguration ? o(r.pixelData, a) : i(r.pixelData, a);\n      }\n    }\n\n    var ae = function ae(e, t) {\n      if (t = t || e.transferSyntax, 8 === e.bitsAllocated && \"1.2.840.10008.1.2.4.50\" === t && (3 === e.samplesPerPixel || 4 === e.samplesPerPixel)) return !0;\n    },\n        ne = \"\";\n\n    var oe = function oe(v, e, x, t) {\n      if (!e || !e.length) return Promise.reject(new Error(\"The file does not contain image data.\"));\n      var h = fe.cornerstone,\n          w = document.createElement(\"canvas\"),\n          r = O(v),\n          a = $(r, x, e, w, t);\n      return new Promise(function (g, e) {\n        a.then(function (e) {\n          var t,\n              r = h.metaData.get(\"imagePlaneModule\", v) || {},\n              a = h.metaData.get(\"voiLutModule\", v) || {},\n              n = h.metaData.get(\"modalityLutModule\", v) || {},\n              o = h.metaData.get(\"sopCommonModule\", v) || {},\n              i = ee(e.photometricInterpretation);\n\n          if (!ae(e, x) && (32 === (t = e).bitsAllocated ? t.pixelData = new Float32Array(t.pixelData) : 16 === t.bitsAllocated ? 0 === t.pixelRepresentation ? t.pixelData = new Uint16Array(t.pixelData) : t.pixelData = new Int16Array(t.pixelData) : t.pixelData = new Uint8Array(t.pixelData), i)) {\n            w.height = e.rows, w.width = e.columns;\n            var l = w.getContext(\"2d\").createImageData(e.columns, e.rows);\n            re(e, l), e.imageData = l, e.pixelData = l.data;\n            var s = Object(z.a)(e.pixelData);\n            e.smallestPixelValue = s.min, e.largestPixelValue = s.max;\n          }\n\n          var u,\n              c = {\n            imageId: v,\n            color: i,\n            columnPixelSpacing: r.columnPixelSpacing,\n            columns: e.columns,\n            height: e.rows,\n            intercept: n.rescaleIntercept ? n.rescaleIntercept : 0,\n            invert: \"MONOCHROME1\" === e.photometricInterpretation,\n            minPixelValue: e.smallestPixelValue,\n            maxPixelValue: e.largestPixelValue,\n            rowPixelSpacing: r.rowPixelSpacing,\n            rows: e.rows,\n            sizeInBytes: e.pixelData.length,\n            slope: n.rescaleSlope ? n.rescaleSlope : 1,\n            width: e.columns,\n            windowCenter: a.windowCenter ? a.windowCenter[0] : void 0,\n            windowWidth: a.windowWidth ? a.windowWidth[0] : void 0,\n            decodeTimeInMS: e.decodeTimeInMS,\n            floatPixelData: void 0\n          };\n\n          if (e.pixelData instanceof Float32Array) {\n            var f = e.pixelData,\n                d = function (e) {\n              for (var t = Object(z.a)(e), r = Math.abs(t.max - t.min) / 65535, a = t.min, n = e.length, o = new Uint16Array(n), i = 65535, l = 0, s = 0; s < n; s++) {\n                var u = Math.floor((e[s] - a) / r);\n                o[s] = u, i = Math.min(i, u), l = Math.max(l, u);\n              }\n\n              return {\n                min: i,\n                max: l,\n                intPixelData: o,\n                slope: r,\n                intercept: a\n              };\n            }(f);\n\n            c.minPixelValue = d.min, c.maxPixelValue = d.max, c.slope = d.slope, c.intercept = d.intercept, c.floatPixelData = f, c.getPixelData = function () {\n              return d.intPixelData;\n            };\n          } else c.getPixelData = function () {\n            return e.pixelData;\n          };\n\n          if (c.color && (c.getCanvas = function () {\n            return ne === v || (w.height = c.rows, w.width = c.columns, w.getContext(\"2d\").putImageData(e.imageData, 0, 0), ne = v), w;\n          }), n.modalityLUTSequence && 0 < n.modalityLUTSequence.length && \"1.2.840.10008.5.1.4.1.1.12.1\" !== (u = o.sopClassUID) && \"1.2.840.10008.5.1.4.1.1.12.2.1\" !== u && (c.modalityLUT = n.modalityLUTSequence[0]), a.voiLUTSequence && 0 < a.voiLUTSequence.length && (c.voiLUT = a.voiLUTSequence[0]), c.color && (c.windowWidth = 255, c.windowCenter = 127), void 0 === c.windowCenter || void 0 === c.windowWidth) {\n            var p = c.maxPixelValue * c.slope + c.intercept,\n                m = c.minPixelValue * c.slope + c.intercept;\n            c.windowWidth = p - m, c.windowCenter = (p + m) / 2;\n          }\n\n          g(c);\n        }, e);\n      });\n    };\n\n    var ie = function ie(o, i) {\n      var l = new Date().getTime(),\n          t = o.substring(7);\n      return {\n        promise: new Promise(function (a, n) {\n          if (void 0 === y.get(o)) {\n            var e = new Error(\"no metadata for imageId \".concat(o));\n            return n(e);\n          }\n\n          S(t, o, 'multipart/related; type=\"application/octet-stream\"').then(function (e) {\n            var t = function (e) {\n              var t = \"1.2.840.10008.1.2\";\n              if (!e) return t;\n              var r = e.split(\";\"),\n                  a = {};\n              r.forEach(function (e) {\n                var t = e.split(\"=\");\n\n                if (2 === t.length) {\n                  var r = t[1].trim().replace(/\"/g, \"\");\n                  a[t[0].trim()] = r;\n                }\n              });\n              var n = {\n                \"image/jpeg\": \"1.2.840.10008.1.2.4.70\",\n                \"image/x-dicom-rle\": \"1.2.840.10008.1.2.5\",\n                \"image/x-jls\": \"1.2.840.10008.1.2.4.80\",\n                \"image/jp2\": \"1.2.840.10008.1.2.4.90\",\n                \"image/jpx\": \"1.2.840.10008.1.2.4.92\"\n              };\n              return a[\"transfer-syntax\"] ? a[\"transfer-syntax\"] : e && !Object.keys(a).length && n[e] ? n[e] : a.type && n[a.type] ? n[a.type] : t;\n            }(e.contentType),\n                r = e.imageFrame.pixelData;\n\n            oe(o, r, t, i).then(function (e) {\n              var t = new Date().getTime();\n              e.loadTimeInMS = t - l, a(e);\n            }, n);\n          }, n);\n        }),\n        cancelFn: void 0\n      };\n    },\n        le = {\n      metaData: {\n        getNumberString: f,\n        getNumberValue: p,\n        getNumberValues: m,\n        getValue: d,\n        metaDataProvider: P\n      },\n      findIndexOfString: I,\n      getPixelData: S,\n      loadImage: ie,\n      metaDataManager: y,\n      register: function register(e) {\n        e.registerImageLoader(\"wadors\", ie), e.metaData.addProvider(P);\n      }\n    };\n\n    var se,\n        ue,\n        ce = function ce(e) {\n      le.register(e), Le.register(e);\n    },\n        fe = {\n      set cornerstone(e) {\n        ce(se = e);\n      },\n\n      get cornerstone() {\n        if (!se) {\n          if (!window || !window.cornerstone) throw new Error(\"cornerstoneWADOImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneWADOImageLoader.external.cornerstone = cornerstone; to your application.\");\n          se = window.cornerstone, ce(se);\n        }\n\n        return se;\n      },\n\n      set dicomParser(e) {\n        ue = e;\n      },\n\n      get dicomParser() {\n        if (!ue) {\n          if (!window || !window.dicomParser) throw new Error(\"cornerstoneWADOImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneWADOImageLoader.external.dicomParser = dicomParser; to your application.\");\n          ue = window.dicomParser;\n        }\n\n        return ue;\n      }\n\n    };\n\n    var de = function de(e) {\n      var t,\n          r = e.indexOf(\":\"),\n          a = e.substring(r + 1),\n          n = a.indexOf(\"frame=\");\n\n      if (-1 !== n) {\n        var o = a.substr(n + 6);\n        t = parseInt(o, 10), a = a.substr(0, n - 1);\n      }\n\n      return {\n        scheme: e.substr(0, r),\n        url: a,\n        frame: t\n      };\n    },\n        pe = 0,\n        me = {},\n        ge = {};\n\n    function ve() {\n      return {\n        cacheSizeInBytes: pe,\n        numberOfDataSetsCached: Object.keys(me).length\n      };\n    }\n\n    var xe = {\n      isLoaded: function isLoaded(e) {\n        return void 0 !== me[e];\n      },\n      load: function load(o) {\n        var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : A,\n            t = 2 < arguments.length ? arguments[2] : void 0,\n            i = fe.cornerstone,\n            l = fe.dicomParser;\n        if (me[o]) return new Promise(function (e) {\n          me[o].cacheCount++, e(me[o].dataSet);\n        });\n        if (ge[o]) return ge[o].cacheCount++, ge[o];\n        var r = e(o, t),\n            s = new Promise(function (a, n) {\n          r.then(function (e) {\n            var t,\n                r = new Uint8Array(e);\n\n            try {\n              t = l.parseDicom(r);\n            } catch (e) {\n              return n(e);\n            }\n\n            me[o] = {\n              dataSet: t,\n              cacheCount: s.cacheCount\n            }, pe += t.byteArray.length, a(t), i.triggerEvent(i.events, \"datasetscachechanged\", {\n              uri: o,\n              action: \"loaded\",\n              cacheInfo: ve()\n            });\n          }, n).then(function () {\n            delete ge[o];\n          }, function () {\n            delete ge[o];\n          });\n        });\n        return s.cacheCount = 1, ge[o] = s;\n      },\n      unload: function unload(e) {\n        var t = fe.cornerstone;\n        me[e] && (me[e].cacheCount--, 0 === me[e].cacheCount && (pe -= me[e].dataSet.byteArray.length, delete me[e], t.triggerEvent(t.events, \"datasetscachechanged\", {\n          uri: e,\n          action: \"unloaded\",\n          cacheInfo: ve()\n        })));\n      },\n      getInfo: ve,\n      purge: function purge() {\n        me = {}, ge = {};\n      },\n      get: function get(e) {\n        if (me[e]) return me[e].dataSet;\n      }\n    };\n\n    var he = function he(e, t) {\n      var r = fe.dicomParser,\n          a = de(t),\n          n = xe.get(a.url);\n\n      if (n) {\n        if (\"generalSeriesModule\" === e) return {\n          modality: n.string(\"x00080060\"),\n          seriesInstanceUID: n.string(\"x0020000e\"),\n          seriesNumber: n.intString(\"x00200011\"),\n          studyInstanceUID: n.string(\"x0020000d\"),\n          seriesDate: r.parseDA(n.string(\"x00080021\")),\n          seriesTime: r.parseTM(n.string(\"x00080031\") || \"\")\n        };\n        if (\"patientStudyModule\" === e) return {\n          patientAge: n.intString(\"x00101010\"),\n          patientSize: n.floatString(\"x00101020\"),\n          patientWeight: n.floatString(\"x00101030\")\n        };\n\n        if (\"imagePlaneModule\" === e) {\n          var o = w(n, \"x00200037\", 6),\n              i = w(n, \"x00200032\", 3),\n              l = w(n, \"x00280030\", 2),\n              s = null,\n              u = null;\n          l && (u = l[0], s = l[1]);\n          var c = null,\n              f = null;\n          return o && (c = [parseFloat(o[0]), parseFloat(o[1]), parseFloat(o[2])], f = [parseFloat(o[3]), parseFloat(o[4]), parseFloat(o[5])]), {\n            frameOfReferenceUID: n.string(\"x00200052\"),\n            rows: n.uint16(\"x00280010\"),\n            columns: n.uint16(\"x00280011\"),\n            imageOrientationPatient: o,\n            rowCosines: c,\n            columnCosines: f,\n            imagePositionPatient: i,\n            sliceThickness: n.floatString(\"x00180050\"),\n            sliceLocation: n.floatString(\"x00201041\"),\n            pixelSpacing: l,\n            rowPixelSpacing: u,\n            columnPixelSpacing: s\n          };\n        }\n\n        if (\"imagePixelModule\" === e) return g(n);\n        if (\"modalityLutModule\" === e) return {\n          rescaleIntercept: n.floatString(\"x00281052\"),\n          rescaleSlope: n.floatString(\"x00281053\"),\n          rescaleType: n.string(\"x00281054\"),\n          modalityLUTSequence: v(n.uint16(\"x00280103\"), n.elements.x00283000)\n        };\n\n        if (\"voiLutModule\" === e) {\n          var d = h(n);\n          return {\n            windowCenter: w(n, \"x00281050\", 1),\n            windowWidth: w(n, \"x00281051\", 1),\n            voiLUTSequence: v(d, n.elements.x00283010)\n          };\n        }\n\n        if (\"sopCommonModule\" === e) return {\n          sopClassUID: n.string(\"x00080016\"),\n          sopInstanceUID: n.string(\"x00080018\")\n        };\n\n        if (\"petIsotopeModule\" === e) {\n          var p = n.elements.x00540016;\n          if (void 0 === p) return;\n          var m = p.items[0].dataSet;\n          return {\n            radiopharmaceuticalInfo: {\n              radiopharmaceuticalStartTime: r.parseTM(m.string(\"x00181072\") || \"\"),\n              radionuclideTotalDose: m.floatString(\"x00181074\"),\n              radionuclideHalfLife: m.floatString(\"x00181075\")\n            }\n          };\n        }\n      }\n    },\n        we = [];\n\n    var be = {\n      add: function add(e) {\n        var t = we.push(e);\n        return \"dicomfile:\".concat(t - 1);\n      },\n      get: function get(e) {\n        return we[e];\n      },\n      remove: function remove(e) {\n        we[e] = void 0;\n      },\n      purge: function purge() {\n        we = [];\n      }\n    };\n\n    function ye(e, t) {\n      var r,\n          a = fe.dicomParser;\n      if (e.elements.x7fe00010 && e.elements.x7fe00010.basicOffsetTable.length) return a.readEncapsulatedImageFrame(e, e.elements.x7fe00010, t);\n      if ((r = e).intString(\"x00280008\") === r.elements.x7fe00010.fragments.length) return a.readEncapsulatedPixelDataFromFragments(e, e.elements.x7fe00010, t);\n      var n = a.createJPEGBasicOffsetTable(e, e.elements.x7fe00010);\n      return a.readEncapsulatedImageFrame(e, e.elements.x7fe00010, t, n);\n    }\n\n    var Pe = function Pe(e, t, r) {\n      for (var a = new Uint8Array(r), n = 0; n < r; n++) {\n        var o = e[Math.floor(n / 8) + t],\n            i = n % 8;\n        a[n] = o & 1 << i ? 1 : 0;\n      }\n\n      return a;\n    };\n\n    var De = function De(e, t) {\n      var r,\n          a = e.elements.x7fe00010 || e.elements.x7fe00008,\n          n = e.uint16(\"x00280100\"),\n          o = e.uint16(\"x00280010\"),\n          i = e.uint16(\"x00280011\"),\n          l = e.uint16(\"x00280002\"),\n          s = a.dataOffset,\n          u = o * i * l;\n\n      if (8 === n) {\n        if ((r = s + t * u) >= e.byteArray.length) throw new Error(\"frame exceeds size of pixelData\");\n        return new Uint8Array(e.byteArray.buffer, r, u);\n      }\n\n      if (16 === n) {\n        if ((r = s + t * u * 2) >= e.byteArray.length) throw new Error(\"frame exceeds size of pixelData\");\n        return new Uint8Array(e.byteArray.buffer, r, 2 * u);\n      }\n\n      if (1 === n) {\n        if ((r = s + t * u * .125) >= e.byteArray.length) throw new Error(\"frame exceeds size of pixelData\");\n        return Pe(e.byteArray, r, u);\n      }\n\n      if (32 !== n) throw new Error(\"unsupported pixel format\");\n      if ((r = s + t * u * 4) >= e.byteArray.length) throw new Error(\"frame exceeds size of pixelData\");\n      return new Uint8Array(e.byteArray.buffer, r, 4 * u);\n    };\n\n    var Ie = function Ie(e) {\n      var t = de(e),\n          r = parseInt(t.url, 10),\n          a = be.get(r);\n      return new Promise(function (r, e) {\n        var t = new FileReader();\n        t.onload = function (e) {\n          var t = e.target.result;\n          r(t);\n        }, t.onerror = e, t.readAsArrayBuffer(a);\n      });\n    };\n\n    var Te = function Te(e) {\n      var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 0,\n          r = e.elements.x7fe00010 || e.elements.x7fe00008;\n      return r ? r.encapsulatedPixelData ? ye(e, t) : De(e, t) : null;\n    };\n\n    function Ce(e, s) {\n      var u = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0,\n          c = 3 < arguments.length ? arguments[3] : void 0,\n          f = 4 < arguments.length ? arguments[4] : void 0,\n          d = 5 < arguments.length ? arguments[5] : void 0,\n          p = new Date().getTime(),\n          m = {\n        cancelFn: void 0\n      };\n      return m.promise = new Promise(function (i, l) {\n        e.then(function (r) {\n          var t,\n              e = Te(r, u),\n              a = r.string(\"x00020010\"),\n              n = new Date().getTime(),\n              o = oe(s, e, a, f);\n          t = s, m.decache = function () {\n            var e = de(t);\n            xe.unload(e.url);\n          }, o.then(function (e) {\n            e.data = r, e.sharedCacheKey = c;\n            var t = new Date().getTime();\n            e.loadTimeInMS = n - p, e.totalTimeInMS = t - p, void 0 !== d && void 0 !== d.imageDoneCallback && d.imageDoneCallback(e), i(e);\n          }, function (e) {\n            l({\n              error: e,\n              dataSet: r\n            });\n          });\n        }, function (e) {\n          l({\n            error: e\n          });\n        });\n      }), m;\n    }\n\n    function ke(e) {\n      return \"dicomweb\" === e || \"wadouri\" === e ? A : \"dicomfile\" === e ? Ie : void 0;\n    }\n\n    function Ae(e) {\n      var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {},\n          r = de(e),\n          a = (t = Object.assign({}, t)).loader;\n      return void 0 === a ? a = ke(r.scheme) : delete t.loader, xe.isLoaded(r.url) ? function (i, l) {\n        var s = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : 0,\n            u = 3 < arguments.length ? arguments[3] : void 0,\n            c = 4 < arguments.length ? arguments[4] : void 0,\n            f = new Date().getTime();\n        return {\n          promise: new Promise(function (r, t) {\n            var e,\n                a = new Date().getTime();\n\n            try {\n              var n = Te(i, s),\n                  o = i.string(\"x00020010\");\n              e = oe(l, n, o, c);\n            } catch (e) {\n              return void t({\n                error: e,\n                dataSet: i\n              });\n            }\n\n            e.then(function (e) {\n              e.data = i, e.sharedCacheKey = u;\n              var t = new Date().getTime();\n              e.loadTimeInMS = a - f, e.totalTimeInMS = t - f, r(e);\n            }, t);\n          }),\n          cancelFn: void 0\n        };\n      }(xe.get(r.url, a, e), e, r.frame, r.url, t) : Ce(xe.load(r.url, a, e), e, r.frame, r.url, t);\n    }\n\n    var Le = {\n      metaData: {\n        getImagePixelModule: g,\n        getLUTs: v,\n        getModalityLUTOutputPixelRepresentation: h,\n        getNumberValues: w,\n        metaDataProvider: he\n      },\n      dataSetCacheManager: xe,\n      fileManager: be,\n      getEncapsulatedImageFrame: ye,\n      getUncompressedImageFrame: De,\n      loadFileRequest: Ie,\n      loadImageFromPromise: Ce,\n      getLoaderForScheme: ke,\n      loadImage: Ae,\n      parseImageId: de,\n      unpackBinaryFrame: Pe,\n      register: function register(e) {\n        e.registerImageLoader(\"dicomweb\", Ae), e.registerImageLoader(\"wadouri\", Ae), e.registerImageLoader(\"dicomfile\", Ae), e.metaData.addProvider(he);\n      }\n    };\n\n    var Se = function Se(e) {\n      C(e);\n    },\n        Ee = r(3);\n\n    r.d(t, \"convertRGBColorByPixel\", function () {\n      return a;\n    }), r.d(t, \"convertRGBColorByPlane\", function () {\n      return n;\n    }), r.d(t, \"convertYBRFullByPixel\", function () {\n      return o;\n    }), r.d(t, \"convertYBRFullByPlane\", function () {\n      return i;\n    }), r.d(t, \"convertPALETTECOLOR\", function () {\n      return l;\n    }), r.d(t, \"wadouri\", function () {\n      return Le;\n    }), r.d(t, \"wadors\", function () {\n      return le;\n    }), r.d(t, \"configure\", function () {\n      return Se;\n    }), r.d(t, \"convertColorSpace\", function () {\n      return re;\n    }), r.d(t, \"createImage\", function () {\n      return oe;\n    }), r.d(t, \"decodeImageFrame\", function () {\n      return $;\n    }), r.d(t, \"decodeJPEGBaseline8BitColor\", function () {\n      return Y;\n    }), r.d(t, \"getImageFrame\", function () {\n      return O;\n    }), r.d(t, \"getMinMax\", function () {\n      return z.a;\n    }), r.d(t, \"isColorImage\", function () {\n      return ee;\n    }), r.d(t, \"isJPEGBaseline8BitColor\", function () {\n      return ae;\n    }), r.d(t, \"webWorkerManager\", function () {\n      return J;\n    }), r.d(t, \"version\", function () {\n      return Ee.a;\n    }), r.d(t, \"internal\", function () {\n      return L;\n    }), r.d(t, \"external\", function () {\n      return fe;\n    });\n    var Oe = {\n      convertRGBColorByPixel: a,\n      convertRGBColorByPlane: n,\n      convertYBRFullByPixel: o,\n      convertYBRFullByPlane: i,\n      convertPALETTECOLOR: l,\n      wadouri: Le,\n      wadors: le,\n      configure: Se,\n      convertColorSpace: re,\n      createImage: oe,\n      decodeImageFrame: $,\n      decodeJPEGBaseline8BitColor: Y,\n      getImageFrame: O,\n      getMinMax: z.a,\n      isColorImage: ee,\n      isJPEGBaseline8BitColor: ae,\n      webWorkerManager: J,\n      version: Ee.a,\n      internal: L,\n      external: fe\n    };\n    t.default = Oe;\n  }]);\n});","map":null,"metadata":{},"sourceType":"script"}