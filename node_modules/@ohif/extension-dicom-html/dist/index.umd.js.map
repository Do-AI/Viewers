{"version":3,"file":"index.umd.js","sources":["../src/OHIFDicomHtmlSopClassHandler.js","../src/TypedArrayProp.js","../node_modules/style-inject/dist/style-inject.es.js","../src/DicomHtmlViewport.js","../src/OHIFDicomHtmlViewport.js","../src/index.js"],"sourcesContent":["import { MODULE_TYPES, utils } from 'ohif-core';\n\n// TODO: Should probably use dcmjs for this\nconst SOP_CLASS_UIDS = {\n  BASIC_TEXT_SR: '1.2.840.10008.5.1.4.1.1.88.11',\n  ENHANCED_SR: '1.2.840.10008.5.1.4.1.1.88.22',\n  COMPREHENSIVE_SR: '1.2.840.10008.5.1.4.1.1.88.33',\n  PROCEDURE_LOG_STORAGE: '1.2.840.10008.5.1.4.1.1.88.40',\n  MAMMOGRAPHY_CAD_SR: '1.2.840.10008.5.1.4.1.1.88.50',\n  CHEST_CAD_SR: '1.2.840.10008.5.1.4.1.1.88.65',\n  X_RAY_RADIATION_DOSE_SR: '1.2.840.10008.5.1.4.1.1.88.67'\n};\n\nconst sopClassUids = Object.values(SOP_CLASS_UIDS);\n\n// TODO: Handle the case where there is more than one SOP Class Handler for the\n// same SOP Class\nconst OHIFDicomHtmlSopClassHandler = {\n  id: 'OHIFDicomHtmlSopClassHandler',\n  type: MODULE_TYPES.SOP_CLASS_HANDLER,\n  sopClassUids,\n  getDisplaySetFromSeries(series, study, dicomWebClient, authorizationHeaders) {\n    const instance = series.getFirstInstance();\n\n    return {\n      plugin: 'html',\n      displaySetInstanceUid: utils.guid(),\n      wadoRoot: study.getData().wadoRoot,\n      wadoUri: instance.getData().wadouri,\n      sopInstanceUid: instance.getSOPInstanceUID(),\n      seriesInstanceUid: series.getSeriesInstanceUID(),\n      studyInstanceUid: study.getStudyInstanceUID(),\n      authorizationHeaders\n    };\n  }\n};\n\nexport default OHIFDicomHtmlSopClassHandler;\n","// https://github.com/facebook/prop-types/issues/69\n\nexport const TypedArrayProp = {\n  any: (props, propName, componentName) => {\n    let obj = props[propName];\n    if (\n      !(\n        obj instanceof Float64Array ||\n        obj instanceof Float32Array ||\n        obj instanceof Int32Array ||\n        obj instanceof Int16Array ||\n        obj instanceof Int8Array ||\n        obj instanceof Uint32Array ||\n        obj instanceof Uint16Array ||\n        obj instanceof Uint8Array ||\n        obj instanceof Uint8ClampedArray\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a typed array.'\n      );\n    }\n  },\n\n  float64: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Float64Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Float64Array.'\n      );\n    }\n  },\n\n  float32: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Float32Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Float32Array.'\n      );\n    }\n  },\n\n  float: (props, propName, componentName) => {\n    if (\n      !(\n        props[propName] instanceof Float64Array ||\n        props[propName] instanceof Float32Array\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Float32Array or Float64Array.'\n      );\n    }\n  },\n\n  int32: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Int32Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an Int32Array.'\n      );\n    }\n  },\n\n  int16: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Int16Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an In16Array.'\n      );\n    }\n  },\n\n  int8: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Int8Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an Int8Array.'\n      );\n    }\n  },\n\n  int: (props, propName, componentName) => {\n    if (\n      !(\n        props[propName] instanceof Int32Array ||\n        props[propName] instanceof Int16Array ||\n        props[propName] instanceof Int8Array\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an Int32Array, In16Array, or Int8Array.'\n      );\n    }\n  },\n\n  uint32: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint32Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint32Array.'\n      );\n    }\n  },\n\n  uint16: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint16Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint16Array.'\n      );\n    }\n  },\n\n  uint8: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint8Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint8Array.'\n      );\n    }\n  },\n\n  uint8clamped: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint8ClampedArray)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint8ClampedArray.'\n      );\n    }\n  },\n\n  uint: (props, propName, componentName) => {\n    if (\n      !(\n        props[propName] instanceof Uint32Array ||\n        props[propName] instanceof Uint16Array ||\n        props[propName] instanceof Uint8Array ||\n        props[propName] instanceof Uint8ClampedArray\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint32Array, Uint16Array, Uint8Array, or Uint8ClampedArray.'\n      );\n    }\n  }\n};\n\nexport { TypedArrayProp as default };\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, { Component } from 'react';\nimport * as dcmjs from 'dcmjs';\nimport TypedArrayProp from './TypedArrayProp';\nimport './DicomHtmlViewport.css';\n\nfunction getRelationshipString(data) {\n  switch (data.RelationshipType) {\n    case 'HAS CONCEPT MOD':\n      return 'Concept modifier: ';\n    case 'HAS OBS CONTEXT':\n      return 'Observation context: ';\n    default:\n      return '';\n  }\n}\n\nconst getMeaningString = data => {\n  if (data.ConceptNameCodeSequence) {\n    const { CodeMeaning } = data.ConceptNameCodeSequence;\n\n    return `${CodeMeaning} = `;\n  }\n\n  return '';\n};\n\nfunction getValueString(data) {\n  switch (data.ValueType) {\n    case 'CODE':\n      const {\n        CodeMeaning,\n        CodeValue,\n        CodingSchemeDesignator\n      } = data.ConceptNameCodeSequence;\n\n      return `${CodeMeaning} (${CodeValue}, ${CodingSchemeDesignator})`;\n\n    case 'PNAME':\n      return data.PersonName;\n\n    case 'TEXT':\n      return data.TextValue;\n\n    case 'UIDREF':\n      return data.UID;\n\n    case 'NUM':\n      const { MeasuredValueSequence } = data;\n      const numValue = MeasuredValueSequence.NumericValue;\n      const codeValue =\n        MeasuredValueSequence.MeasurementUnitsCodeSequence.CodeValue;\n      return `${numValue} ${codeValue}`;\n  }\n}\n\nfunction constructPlainValue(data) {\n  const value = getValueString(data);\n\n  if (value) {\n    return getRelationshipString(data) + getMeaningString(data) + value;\n  }\n}\n\nfunction constructContentSequence(data, header) {\n  if (!data.ContentSequence) {\n    return;\n  }\n\n  const items = data.ContentSequence.map(item => parseContent(item)).filter(\n    item => item\n  );\n\n  if (!items.length) {\n    return;\n  }\n\n  const result = {\n    items\n  };\n\n  if (header) {\n    result.header = header;\n  }\n\n  return result;\n}\n\nfunction parseContent(data) {\n  if (data.ValueType) {\n    if (data.ValueType === 'CONTAINER') {\n      const header = data.ConceptNameCodeSequence.CodeMeaning;\n\n      return constructContentSequence(data, header);\n    }\n\n    return constructPlainValue(data);\n  }\n\n  if (data.ContentSequence) {\n    return constructContentSequence(data);\n  }\n}\n\nconst { DicomMetaDictionary, DicomMessage } = dcmjs.data;\n\nfunction getMainData(data) {\n  const root = [];\n\n  const patientValue = `${data.PatientName} (${data.PatientSex}, #${\n    data.PatientID\n  })`;\n  root.push(getMainDataItem('Patient', patientValue));\n\n  const studyValue = data.StudyDescription;\n  root.push(getMainDataItem('Study', studyValue));\n\n  const seriesValue = `${data.SeriesDescription} (#${data.SeriesNumber})`;\n  root.push(getMainDataItem('Series', seriesValue));\n\n  const manufacturerValue = `${data.Manufacturer} (${\n    data.ManufacturerModelName\n  }, #${data.DeviceSerialNumber})`;\n\n  root.push(getMainDataItem('Manufacturer', manufacturerValue));\n\n  const mainDataObjects = {\n    CompletionFlag: 'Completion flag',\n    VerificationFlag: 'Verification flag'\n  };\n\n  Object.keys(mainDataObjects).forEach(key => {\n    if (!data[key]) {\n      return;\n    }\n\n    const item = getMainDataItem(mainDataObjects[key], data[key]);\n\n    root.push(item);\n  });\n\n  // TODO: Format these dates\n  const contentDateTimeValue = `${data.ContentDate} ${data.ContentTime}`;\n  root.push(getMainDataItem('Content Date/Time', contentDateTimeValue));\n\n  root.push();\n\n  return <div>{root}</div>;\n}\n\nconst getContentSequence = (data, level = 1) => {\n  let header;\n\n  if (data.ConceptNameCodeSequence) {\n    const {\n      CodeMeaning,\n      CodeValue,\n      CodingSchemeDesignator\n    } = data.ConceptNameCodeSequence;\n\n    header = `${CodeMeaning} (${CodeValue} - ${CodingSchemeDesignator})`;\n  }\n\n  const root = [];\n  if (header) {\n    const HeaderDynamicLevel = `h${level}`;\n\n    root.push(<HeaderDynamicLevel key={header}>{header}</HeaderDynamicLevel>);\n  }\n\n  Object.keys(data).forEach(key => {\n    const value = data[key];\n\n    let content;\n    if (value instanceof Object) {\n      content = getContentSequence(value, level + 1);\n    } else {\n      content = (\n        <div key={key}>\n          {key} - {data[key]}\n        </div>\n      );\n    }\n\n    root.push(content);\n  });\n\n  return <div>{root}</div>;\n};\n\nfunction getMainDataItem(key, value) {\n  return (\n    <div key={key}>\n      <b>{key}</b>: {value}\n    </div>\n  );\n}\n\nclass DicomHtmlViewport extends Component {\n  state = {\n    content: null,\n    error: null\n  };\n\n  static propTypes = {\n    byteArray: TypedArrayProp.uint8\n  };\n\n  componentDidMount() {\n    const dataSet = this.setContentFromByteArray(this.props.byteArray);\n  }\n\n  setContentFromByteArray(byteArray) {\n    const arrayBuffer = byteArray.buffer;\n    const dicomData = DicomMessage.readFile(arrayBuffer);\n    const dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n    dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n\n    const mainData = getMainData(dataset);\n    const contentSequence = getContentSequence(dataset);\n    const content = (\n      <>\n        {mainData}\n        {contentSequence}\n      </>\n    );\n\n    this.setState({\n      content\n    });\n  }\n\n  render() {\n    return (\n      <div className={'DicomHtmlViewport'}>\n        {this.state.content}\n        {this.state.error && <h2>{JSON.stringify(this.state.error)}</h2>}\n      </div>\n    );\n  }\n}\n\nexport default DicomHtmlViewport;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport DicomHtmlViewport from './DicomHtmlViewport';\n\nclass OHIFDicomHtmlViewport extends Component {\n  static propTypes = {\n    studies: PropTypes.object,\n    displaySet: PropTypes.object,\n    viewportIndex: PropTypes.number\n  };\n\n  state = {\n    byteArray: null,\n    error: null\n  };\n\n  componentDidMount() {\n    const { displaySet } = this.props.viewportData;\n    const {\n      studyInstanceUid,\n      seriesInstanceUid,\n      sopInstanceUid,\n      wadoRoot,\n      wadoUri,\n      authorizationHeaders\n    } = displaySet;\n\n    this.retrieveDicomData(\n      studyInstanceUid,\n      seriesInstanceUid,\n      sopInstanceUid,\n      wadoRoot,\n      wadoUri,\n      authorizationHeaders\n    ).then(\n      byteArray => {\n        this.setState({\n          byteArray\n        });\n      },\n      error => {\n        this.setState({\n          error\n        });\n\n        throw new Error(error);\n      }\n    );\n  }\n\n  retrieveDicomData(\n    studyInstanceUid,\n    seriesInstanceUid,\n    sopInstanceUid,\n    wadoRoot,\n    wadoUri,\n    authorizationHeaders\n  ) {\n    // TODO: Passing in a lot of data we aren't using\n\n    // TODO: Authorization header depends on the server. If we ever have multiple servers\n    // we will need to figure out how / when to pass this information in.\n    return fetch(wadoUri, {\n      headers: authorizationHeaders\n    })\n      .then(response => response.arrayBuffer())\n      .then(arraybuffer => {\n        return new Uint8Array(arraybuffer);\n      });\n  }\n\n  render() {\n    return (\n      <>\n        {this.state.byteArray && (\n          <DicomHtmlViewport byteArray={this.state.byteArray} />\n        )}\n        {this.state.error && <h2>{JSON.stringify(this.state.error)}</h2>}\n      </>\n    );\n  }\n}\n\nexport default OHIFDicomHtmlViewport;\n","import OHIFDicomHtmlSopClassHandler from './OHIFDicomHtmlSopClassHandler.js';\nimport OHIFDicomHtmlViewport from './OHIFDicomHtmlViewport.js';\n\nexport default {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id: 'html',\n\n  getViewportModule() {\n    return OHIFDicomHtmlViewport;\n  },\n  getSopClassHandlerModule() {\n    return OHIFDicomHtmlSopClassHandler;\n  }\n};\n"],"names":["SOP_CLASS_UIDS","BASIC_TEXT_SR","ENHANCED_SR","COMPREHENSIVE_SR","PROCEDURE_LOG_STORAGE","MAMMOGRAPHY_CAD_SR","CHEST_CAD_SR","X_RAY_RADIATION_DOSE_SR","sopClassUids","Object","values","OHIFDicomHtmlSopClassHandler","id","type","MODULE_TYPES","SOP_CLASS_HANDLER","getDisplaySetFromSeries","series","study","dicomWebClient","authorizationHeaders","instance","getFirstInstance","plugin","displaySetInstanceUid","utils","guid","wadoRoot","getData","wadoUri","wadouri","sopInstanceUid","getSOPInstanceUID","seriesInstanceUid","getSeriesInstanceUID","studyInstanceUid","getStudyInstanceUID","TypedArrayProp","any","props","propName","componentName","obj","Float64Array","Float32Array","Int32Array","Int16Array","Int8Array","Uint32Array","Uint16Array","Uint8Array","Uint8ClampedArray","Error","float64","float32","float","int32","int16","int8","int","uint32","uint16","uint8","uint8clamped","uint","dcmjs","DicomMetaDictionary","DicomMessage","getMainData","data","root","patientValue","PatientName","PatientSex","PatientID","push","getMainDataItem","studyValue","StudyDescription","seriesValue","SeriesDescription","SeriesNumber","manufacturerValue","Manufacturer","ManufacturerModelName","DeviceSerialNumber","mainDataObjects","CompletionFlag","VerificationFlag","keys","forEach","key","item","contentDateTimeValue","ContentDate","ContentTime","React","getContentSequence","level","header","ConceptNameCodeSequence","CodeMeaning","CodeValue","CodingSchemeDesignator","HeaderDynamicLevel","value","content","DicomHtmlViewport","error","dataSet","setContentFromByteArray","byteArray","arrayBuffer","buffer","dicomData","readFile","dataset","naturalizeDataset","dict","_meta","namifyDataset","meta","mainData","contentSequence","setState","state","JSON","stringify","Component","OHIFDicomHtmlViewport","displaySet","viewportData","retrieveDicomData","then","fetch","headers","response","arraybuffer","studies","PropTypes","object","viewportIndex","number","getViewportModule","getSopClassHandlerModule"],"mappings":"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"}