{"version":3,"file":"index.es.js","sources":["../src/OHIFDicomHtmlSopClassHandler.js","../src/TypedArrayProp.js","../node_modules/style-inject/dist/style-inject.es.js","../src/DicomHtmlViewport.js","../src/OHIFDicomHtmlViewport.js","../src/index.js"],"sourcesContent":["import { MODULE_TYPES, utils } from 'ohif-core';\n\n// TODO: Should probably use dcmjs for this\nconst SOP_CLASS_UIDS = {\n  BASIC_TEXT_SR: '1.2.840.10008.5.1.4.1.1.88.11',\n  ENHANCED_SR: '1.2.840.10008.5.1.4.1.1.88.22',\n  COMPREHENSIVE_SR: '1.2.840.10008.5.1.4.1.1.88.33',\n  PROCEDURE_LOG_STORAGE: '1.2.840.10008.5.1.4.1.1.88.40',\n  MAMMOGRAPHY_CAD_SR: '1.2.840.10008.5.1.4.1.1.88.50',\n  CHEST_CAD_SR: '1.2.840.10008.5.1.4.1.1.88.65',\n  X_RAY_RADIATION_DOSE_SR: '1.2.840.10008.5.1.4.1.1.88.67'\n};\n\nconst sopClassUids = Object.values(SOP_CLASS_UIDS);\n\n// TODO: Handle the case where there is more than one SOP Class Handler for the\n// same SOP Class\nconst OHIFDicomHtmlSopClassHandler = {\n  id: 'OHIFDicomHtmlSopClassHandler',\n  type: MODULE_TYPES.SOP_CLASS_HANDLER,\n  sopClassUids,\n  getDisplaySetFromSeries(series, study, dicomWebClient, authorizationHeaders) {\n    const instance = series.getFirstInstance();\n\n    return {\n      plugin: 'html',\n      displaySetInstanceUid: utils.guid(),\n      wadoRoot: study.getData().wadoRoot,\n      wadoUri: instance.getData().wadouri,\n      sopInstanceUid: instance.getSOPInstanceUID(),\n      seriesInstanceUid: series.getSeriesInstanceUID(),\n      studyInstanceUid: study.getStudyInstanceUID(),\n      authorizationHeaders\n    };\n  }\n};\n\nexport default OHIFDicomHtmlSopClassHandler;\n","// https://github.com/facebook/prop-types/issues/69\n\nexport const TypedArrayProp = {\n  any: (props, propName, componentName) => {\n    let obj = props[propName];\n    if (\n      !(\n        obj instanceof Float64Array ||\n        obj instanceof Float32Array ||\n        obj instanceof Int32Array ||\n        obj instanceof Int16Array ||\n        obj instanceof Int8Array ||\n        obj instanceof Uint32Array ||\n        obj instanceof Uint16Array ||\n        obj instanceof Uint8Array ||\n        obj instanceof Uint8ClampedArray\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a typed array.'\n      );\n    }\n  },\n\n  float64: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Float64Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Float64Array.'\n      );\n    }\n  },\n\n  float32: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Float32Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Float32Array.'\n      );\n    }\n  },\n\n  float: (props, propName, componentName) => {\n    if (\n      !(\n        props[propName] instanceof Float64Array ||\n        props[propName] instanceof Float32Array\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Float32Array or Float64Array.'\n      );\n    }\n  },\n\n  int32: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Int32Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an Int32Array.'\n      );\n    }\n  },\n\n  int16: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Int16Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an In16Array.'\n      );\n    }\n  },\n\n  int8: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Int8Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an Int8Array.'\n      );\n    }\n  },\n\n  int: (props, propName, componentName) => {\n    if (\n      !(\n        props[propName] instanceof Int32Array ||\n        props[propName] instanceof Int16Array ||\n        props[propName] instanceof Int8Array\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected an Int32Array, In16Array, or Int8Array.'\n      );\n    }\n  },\n\n  uint32: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint32Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint32Array.'\n      );\n    }\n  },\n\n  uint16: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint16Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint16Array.'\n      );\n    }\n  },\n\n  uint8: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint8Array)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint8Array.'\n      );\n    }\n  },\n\n  uint8clamped: (props, propName, componentName) => {\n    if (!(props[propName] instanceof Uint8ClampedArray)) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint8ClampedArray.'\n      );\n    }\n  },\n\n  uint: (props, propName, componentName) => {\n    if (\n      !(\n        props[propName] instanceof Uint32Array ||\n        props[propName] instanceof Uint16Array ||\n        props[propName] instanceof Uint8Array ||\n        props[propName] instanceof Uint8ClampedArray\n      )\n    ) {\n      return new Error(\n        'Invalid prop `' +\n          propName +\n          '` supplied to' +\n          ' `' +\n          componentName +\n          '`. Expected a Uint32Array, Uint16Array, Uint8Array, or Uint8ClampedArray.'\n      );\n    }\n  }\n};\n\nexport { TypedArrayProp as default };\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, { Component } from 'react';\nimport * as dcmjs from 'dcmjs';\nimport TypedArrayProp from './TypedArrayProp';\nimport './DicomHtmlViewport.css';\n\nfunction getRelationshipString(data) {\n  switch (data.RelationshipType) {\n    case 'HAS CONCEPT MOD':\n      return 'Concept modifier: ';\n    case 'HAS OBS CONTEXT':\n      return 'Observation context: ';\n    default:\n      return '';\n  }\n}\n\nconst getMeaningString = data => {\n  if (data.ConceptNameCodeSequence) {\n    const { CodeMeaning } = data.ConceptNameCodeSequence;\n\n    return `${CodeMeaning} = `;\n  }\n\n  return '';\n};\n\nfunction getValueString(data) {\n  switch (data.ValueType) {\n    case 'CODE':\n      const {\n        CodeMeaning,\n        CodeValue,\n        CodingSchemeDesignator\n      } = data.ConceptNameCodeSequence;\n\n      return `${CodeMeaning} (${CodeValue}, ${CodingSchemeDesignator})`;\n\n    case 'PNAME':\n      return data.PersonName;\n\n    case 'TEXT':\n      return data.TextValue;\n\n    case 'UIDREF':\n      return data.UID;\n\n    case 'NUM':\n      const { MeasuredValueSequence } = data;\n      const numValue = MeasuredValueSequence.NumericValue;\n      const codeValue =\n        MeasuredValueSequence.MeasurementUnitsCodeSequence.CodeValue;\n      return `${numValue} ${codeValue}`;\n  }\n}\n\nfunction constructPlainValue(data) {\n  const value = getValueString(data);\n\n  if (value) {\n    return getRelationshipString(data) + getMeaningString(data) + value;\n  }\n}\n\nfunction constructContentSequence(data, header) {\n  if (!data.ContentSequence) {\n    return;\n  }\n\n  const items = data.ContentSequence.map(item => parseContent(item)).filter(\n    item => item\n  );\n\n  if (!items.length) {\n    return;\n  }\n\n  const result = {\n    items\n  };\n\n  if (header) {\n    result.header = header;\n  }\n\n  return result;\n}\n\nfunction parseContent(data) {\n  if (data.ValueType) {\n    if (data.ValueType === 'CONTAINER') {\n      const header = data.ConceptNameCodeSequence.CodeMeaning;\n\n      return constructContentSequence(data, header);\n    }\n\n    return constructPlainValue(data);\n  }\n\n  if (data.ContentSequence) {\n    return constructContentSequence(data);\n  }\n}\n\nconst { DicomMetaDictionary, DicomMessage } = dcmjs.data;\n\nfunction getMainData(data) {\n  const root = [];\n\n  const patientValue = `${data.PatientName} (${data.PatientSex}, #${\n    data.PatientID\n  })`;\n  root.push(getMainDataItem('Patient', patientValue));\n\n  const studyValue = data.StudyDescription;\n  root.push(getMainDataItem('Study', studyValue));\n\n  const seriesValue = `${data.SeriesDescription} (#${data.SeriesNumber})`;\n  root.push(getMainDataItem('Series', seriesValue));\n\n  const manufacturerValue = `${data.Manufacturer} (${\n    data.ManufacturerModelName\n  }, #${data.DeviceSerialNumber})`;\n\n  root.push(getMainDataItem('Manufacturer', manufacturerValue));\n\n  const mainDataObjects = {\n    CompletionFlag: 'Completion flag',\n    VerificationFlag: 'Verification flag'\n  };\n\n  Object.keys(mainDataObjects).forEach(key => {\n    if (!data[key]) {\n      return;\n    }\n\n    const item = getMainDataItem(mainDataObjects[key], data[key]);\n\n    root.push(item);\n  });\n\n  // TODO: Format these dates\n  const contentDateTimeValue = `${data.ContentDate} ${data.ContentTime}`;\n  root.push(getMainDataItem('Content Date/Time', contentDateTimeValue));\n\n  root.push();\n\n  return <div>{root}</div>;\n}\n\nconst getContentSequence = (data, level = 1) => {\n  let header;\n\n  if (data.ConceptNameCodeSequence) {\n    const {\n      CodeMeaning,\n      CodeValue,\n      CodingSchemeDesignator\n    } = data.ConceptNameCodeSequence;\n\n    header = `${CodeMeaning} (${CodeValue} - ${CodingSchemeDesignator})`;\n  }\n\n  const root = [];\n  if (header) {\n    const HeaderDynamicLevel = `h${level}`;\n\n    root.push(<HeaderDynamicLevel key={header}>{header}</HeaderDynamicLevel>);\n  }\n\n  Object.keys(data).forEach(key => {\n    const value = data[key];\n\n    let content;\n    if (value instanceof Object) {\n      content = getContentSequence(value, level + 1);\n    } else {\n      content = (\n        <div key={key}>\n          {key} - {data[key]}\n        </div>\n      );\n    }\n\n    root.push(content);\n  });\n\n  return <div>{root}</div>;\n};\n\nfunction getMainDataItem(key, value) {\n  return (\n    <div key={key}>\n      <b>{key}</b>: {value}\n    </div>\n  );\n}\n\nclass DicomHtmlViewport extends Component {\n  state = {\n    content: null,\n    error: null\n  };\n\n  static propTypes = {\n    byteArray: TypedArrayProp.uint8\n  };\n\n  componentDidMount() {\n    const dataSet = this.setContentFromByteArray(this.props.byteArray);\n  }\n\n  setContentFromByteArray(byteArray) {\n    const arrayBuffer = byteArray.buffer;\n    const dicomData = DicomMessage.readFile(arrayBuffer);\n    const dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n    dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\n\n    const mainData = getMainData(dataset);\n    const contentSequence = getContentSequence(dataset);\n    const content = (\n      <>\n        {mainData}\n        {contentSequence}\n      </>\n    );\n\n    this.setState({\n      content\n    });\n  }\n\n  render() {\n    return (\n      <div className={'DicomHtmlViewport'}>\n        {this.state.content}\n        {this.state.error && <h2>{JSON.stringify(this.state.error)}</h2>}\n      </div>\n    );\n  }\n}\n\nexport default DicomHtmlViewport;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport DicomHtmlViewport from './DicomHtmlViewport';\n\nclass OHIFDicomHtmlViewport extends Component {\n  static propTypes = {\n    studies: PropTypes.object,\n    displaySet: PropTypes.object,\n    viewportIndex: PropTypes.number\n  };\n\n  state = {\n    byteArray: null,\n    error: null\n  };\n\n  componentDidMount() {\n    const { displaySet } = this.props.viewportData;\n    const {\n      studyInstanceUid,\n      seriesInstanceUid,\n      sopInstanceUid,\n      wadoRoot,\n      wadoUri,\n      authorizationHeaders\n    } = displaySet;\n\n    this.retrieveDicomData(\n      studyInstanceUid,\n      seriesInstanceUid,\n      sopInstanceUid,\n      wadoRoot,\n      wadoUri,\n      authorizationHeaders\n    ).then(\n      byteArray => {\n        this.setState({\n          byteArray\n        });\n      },\n      error => {\n        this.setState({\n          error\n        });\n\n        throw new Error(error);\n      }\n    );\n  }\n\n  retrieveDicomData(\n    studyInstanceUid,\n    seriesInstanceUid,\n    sopInstanceUid,\n    wadoRoot,\n    wadoUri,\n    authorizationHeaders\n  ) {\n    // TODO: Passing in a lot of data we aren't using\n\n    // TODO: Authorization header depends on the server. If we ever have multiple servers\n    // we will need to figure out how / when to pass this information in.\n    return fetch(wadoUri, {\n      headers: authorizationHeaders\n    })\n      .then(response => response.arrayBuffer())\n      .then(arraybuffer => {\n        return new Uint8Array(arraybuffer);\n      });\n  }\n\n  render() {\n    return (\n      <>\n        {this.state.byteArray && (\n          <DicomHtmlViewport byteArray={this.state.byteArray} />\n        )}\n        {this.state.error && <h2>{JSON.stringify(this.state.error)}</h2>}\n      </>\n    );\n  }\n}\n\nexport default OHIFDicomHtmlViewport;\n","import OHIFDicomHtmlSopClassHandler from './OHIFDicomHtmlSopClassHandler.js';\nimport OHIFDicomHtmlViewport from './OHIFDicomHtmlViewport.js';\n\nexport default {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id: 'html',\n\n  getViewportModule() {\n    return OHIFDicomHtmlViewport;\n  },\n  getSopClassHandlerModule() {\n    return OHIFDicomHtmlSopClassHandler;\n  }\n};\n"],"names":["SOP_CLASS_UIDS","BASIC_TEXT_SR","ENHANCED_SR","COMPREHENSIVE_SR","PROCEDURE_LOG_STORAGE","MAMMOGRAPHY_CAD_SR","CHEST_CAD_SR","X_RAY_RADIATION_DOSE_SR","sopClassUids","Object","values","OHIFDicomHtmlSopClassHandler","id","type","MODULE_TYPES","SOP_CLASS_HANDLER","getDisplaySetFromSeries","series","study","dicomWebClient","authorizationHeaders","instance","getFirstInstance","plugin","displaySetInstanceUid","utils","guid","wadoRoot","getData","wadoUri","wadouri","sopInstanceUid","getSOPInstanceUID","seriesInstanceUid","getSeriesInstanceUID","studyInstanceUid","getStudyInstanceUID","TypedArrayProp","any","props","propName","componentName","obj","Float64Array","Float32Array","Int32Array","Int16Array","Int8Array","Uint32Array","Uint16Array","Uint8Array","Uint8ClampedArray","Error","float64","float32","float","int32","int16","int8","int","uint32","uint16","uint8","uint8clamped","uint","dcmjs","DicomMetaDictionary","DicomMessage","getMainData","data","root","patientValue","PatientName","PatientSex","PatientID","push","getMainDataItem","studyValue","StudyDescription","seriesValue","SeriesDescription","SeriesNumber","manufacturerValue","Manufacturer","ManufacturerModelName","DeviceSerialNumber","mainDataObjects","CompletionFlag","VerificationFlag","keys","forEach","key","item","contentDateTimeValue","ContentDate","ContentTime","getContentSequence","level","header","ConceptNameCodeSequence","CodeMeaning","CodeValue","CodingSchemeDesignator","HeaderDynamicLevel","value","content","DicomHtmlViewport","error","dataSet","setContentFromByteArray","byteArray","arrayBuffer","buffer","dicomData","readFile","dataset","naturalizeDataset","dict","_meta","namifyDataset","meta","mainData","contentSequence","setState","state","JSON","stringify","Component","OHIFDicomHtmlViewport","displaySet","viewportData","retrieveDicomData","then","fetch","headers","response","arraybuffer","studies","PropTypes","object","viewportIndex","number","getViewportModule","getSopClassHandlerModule"],"mappings":"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"}